######################################################
# 
# @author Arsakes <elminister@interia.pl>
# @compatibility 2.3.0
# @modified_on 0.4
# @description  Warhammer mod duel action
# @wip
#
#
# Here are duel actions defined that is
# effects of actions that player can perform during duel
namespace = duelengine
namespace = duelaction

#
#
# duelaction.0 - prepare list of actions
# duelaction.1 - clear list of actions 
# duelaction.2 - pick action
# duelaction.3 - resolves action (triggered from duelengine)
#  
# external:duelengine.4 - trigger after picking action
# external:duelengine.5 - trigger after resolving action
#
# Ranges:
# Mechanics:          0-9
# Action definitions: 10-99
# Report events:      100-199
# Duel outcomes:      200-x
#
# The rest are action definitions!


character_event = { 
    id = duelaction.1
    desc = "EVTDESC_DUELACTION_2"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #The Four Basic Actions of the Duel Engine
    option = {
        name = "ACTION_ATTACK"
        trigger = {
            check_variable = { which = can_attack value = 1}
        }
        hidden_tooltip = { 
            set_character_flag = duel_action_attack
            character_event = { id = duelengine.4 }
        }
        ai_chance = { factor = 3 }
    }
    option = {
        name = "ACTION_DEFEND"
        trigger = { 
            check_variable = { which = can_defend value = 1}
        }
        hidden_tooltip = { 
            set_character_flag = duel_action_defend
            character_event = { id = duelengine.4 }
        }
        ai_chance = { factor = 1 }
    }
    #This action opens the special action menu
    option = {
        name = "ACTION_SPECIAL_ATTACK"
        trigger = { 
            has_special_attack = yes
        }
        duel_engine_special_menu_setup = yes
        hidden_tooltip = { 
            character_event = { id = duelaction.2 }
        }
        ai_chance = { factor = 0.5 }
    }
    option = {
        name = "ACTION_FLEE"
        trigger = { 
            check_variable = { which = can_flee value = 1}         
        }
        hidden_tooltip = { 
            set_character_flag = duel_action_flee
            character_event = { id = duelengine.4 }
        }
        ai_chance = { factor = 0.1 }
    }         
}

#Special Action Menu
character_event = { 
    id = duelaction.2
    desc = "EVTDESC_DUELACTION_2"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #This code executes everytime this event is called. It takes the current action number and adds two, and sets this variable to determine the three event options that should be selectable.
    immediate = { 
        set_variable = { which = "local_action_picked_plus_one" which = "local_action_picked"}
        change_variable = { which = "local_action_picked_plus_one" value = "1"}
        set_variable = { which = "local_action_picked_plus_two" which = "local_action_picked_plus_one"}
        change_variable = { which = "local_action_picked_plus_two" value = "1"}
        if = { 
            limit = { 
                check_variable = { which = local_action_picked_plus_one which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_one value = 1}
            set_variable = { which = local_action_picked_plus_two value = 2}
        }
        else_if = { 
            limit = {
                check_variable = { which = local_action_picked_plus_two which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_two value = 1}
        }
    }
    option = {
        name = "NEXT_ACTION"
        if = { 
            limit = { 
                check_variable = { which = "local_action_picked" which >= "local_action_nr" } 
            }
            set_variable = { which = "local_action_picked" value = 1 } # circular menu
            hidden_tooltip = { repeat_event = { id = duelaction.2 }}
        }
        else_if = {
            limit = {  
                check_variable = { which = "local_action_picked" which < "local_action_nr" } 
            }
            change_variable = { which = "local_action_picked" value = 3 }
            if = { 
                limit = { 
                    check_variable = { which = "local_action_picked" which > "local_action_nr" } 
                }
                set_variable = { which = "local_action_picked" value = 1 } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = duelaction.2 }}
        }
        ai_chance = { factor = 1 }
    }
    option = {
        name = "ACTION_WIZARD_SPELLS"
        trigger = {
            check_variable = { which = "spells_wizard" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_wiz_book" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_wiz_book" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_wiz_book" }
            }
        }
        hidden_tooltip = { 
            z_wiz_setup = yes
            wizad_duel_spells_menu = yes
            character_event = { id = duelaction.20001 }
        }
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_SORCERER_SPELLS"
        trigger = {
            always = no
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_sorc_book" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_sorc_book" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_sorc_book" }
            }
        }
        #hidden_tooltip = { 
            z_sorc_setup = yes
            sorcerer_duel_spells_menu = yes
            character_event = { id = duelaction.20002 }
        #}
        ai_chance = { factor = 0 }      
    }    
    option = {
        name = "ACTION_BARD_SPELLS"
        trigger = {
            always = no
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_bard_book" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_bard_book" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_bard_book" }
            }
        }   
        #hidden_tooltip = { 
            z_bard_setup = yes
            bard_duel_spells_menu = yes
            character_event = { id = duelaction.20003 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_WARLOCK_SPELLS"
        trigger = {
            always = no
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_warl_book" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_warl_book" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_warl_book" }
            }
        }   
        #hidden_tooltip = { 
            z_warl_setup = yes
            warlock_duel_spells_menu = yes
            character_event = { id = duelaction.20004 }
        #}
        ai_chance = { factor = 0 }      
    } 
    option = {
        name = "ACTION_CLERIC_SPELLS"
        trigger = {
            always = no
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_cler_book" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_cler_book" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_cler_book" }
            }
        }   
        #hidden_tooltip = { 
            z_cler_setup = yes
            cleric_duel_spells_menu = yes
            character_event = { id = duelaction.20005 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_DRUID_SPELLS"
        trigger = {
            always = no
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_drui_book" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_drui_book" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_drui_book" }
            }
        }   
        #hidden_tooltip = { 
            z_drui_setup = yes
            druid_duel_spells_menu = yes
            character_event = { id = duelaction.20006 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_PALADIN_SPELLS"
        trigger = {
            always = no
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_pala_book" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_pala_book" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_pala_book" }
            }
        }   
        #hidden_tooltip = { 
            z_pala_setup = yes
            paladin_duel_spells_menu = yes
            character_event = { id = duelaction.20007 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_FIGHTER_ABILITIES"
        trigger = {
            always = no
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_figh_book" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_figh_book" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_figh_book" }
            }
        }   
        #hidden_tooltip = { 
            z_fighter_setup = yes
            fighter_duel_abilities_menu = yes
            character_event = { id = duelaction.20008 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_RANGER_ABILITIES"
        trigger = {
            always = no
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_rang_book" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_rang_book" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_rang_book" }
            }
        }   
        #hidden_tooltip = { 
            z_ranger_setup = yes
            ranger_duel_abilities_menu = yes
            character_event = { id = duelaction.20009 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_BARBARIAN_ABILITIES"
        trigger = {
            always = no
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_barb_book" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_barb_book" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_barb_book" }
            }
        }   
        #hidden_tooltip = { 
            z_barbarian_setup = yes
            barbarian_duel_abilities_menu = yes
            character_event = { id = duelaction.20010 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_ROGUE_ABILITIES"
        trigger = {
            always = no
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_rogu_book" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_rogu_book" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_rogu_book" }
            }
        }   
        #hidden_tooltip = { 
            z_rogue_setup = yes
            rogue_duel_abilities_menu = yes
            character_event = { id = duelaction.20011 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_ASSASSIN_ABILITIES"
        trigger = {
            always = no
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_assa_book" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_assa_book" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_assa_book" }
            }
        }   
        #hidden_tooltip = { 
            z_assassin_setup = yes
            assassin_duel_abilities_menu = yes
            character_event = { id = duelaction.20012 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_SHADOW_ABILITIES"
        trigger = {
            always = no
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_shad_book" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_shad_book" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_shad_book" }
            }
        }   
        #hidden_tooltip = { 
            z_shadow_setup = yes
            shadow_duel_abilities_menu = yes
            character_event = { id = duelaction.20013 }
        #}
        ai_chance = { factor = 0 }      
    }     
    #This action exits the special menu, and returns to the default duel action menu.
    option = {
        name = "ACTION_PREVIOUS_MENU"
        trigger = {
            or = {
                check_variable = { which = "local_action_picked" which == "local_d_action_previous_menu" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_d_action_previous_menu" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_d_action_previous_menu" }
            } 
        }
        hidden_tooltip = { character_event = { id = duelaction.1 }}
        ai_chance = { factor = 0 }      
    } 
}


#Wizard Spell Book Menu
character_event = { 
    id = duelaction.20001
    desc = "EVTDESC_DUELACTION_WIZARD"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #This code executes everytime this event is called. It takes the current action number and adds two, and sets this variable to determine the three event options that should be selectable.
    immediate = { 
        z_wiz_setup = yes
        set_variable = { which = "local_action_picked_plus_one" which = "local_action_picked"}
        change_variable = { which = "local_action_picked_plus_one" value = "1"}
        set_variable = { which = "local_action_picked_plus_two" which = "local_action_picked_plus_one"}
        change_variable = { which = "local_action_picked_plus_two" value = "1"}
        if = { 
            limit = { 
                check_variable = { which = local_action_picked_plus_one which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_one value = 1}
            set_variable = { which = local_action_picked_plus_two value = 2}
        }
        else_if = { 
            limit = {
                check_variable = { which = local_action_picked_plus_two which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_two value = 1}
        }
    }
    option = {
        name = "NEXT_ACTION"
        if = { 
            limit = { 
                check_variable = { which = "local_action_picked" which >= "local_action_nr" } 
            }
            set_variable = { which = "local_action_picked" value = 1 } # circular menu
            hidden_tooltip = { repeat_event = { id = duelaction.20001 }}
        }
        else_if = {
            limit = {  
                check_variable = { which = "local_action_picked" which < "local_action_nr" } 
            }
            change_variable = { which = "local_action_picked" value = 3 }
            if = { 
                limit = { 
                    check_variable = { which = "local_action_picked" which > "local_action_nr" } 
                }
                set_variable = { which = "local_action_picked" value = 1 } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = duelaction.20001 }}
        }
        ai_chance = { factor = 1 }
    }
    option = {
        name = "ACTION_WIZARD_ATTACK_CANTRIP-ATTACK"
        custom_tooltip = {
            text = ACTION_WIZARD_ATTACK_CANTRIP-ATTACK_TOOLTIP
        }
        trigger = {
            check_variable = { which = "spells_wizard" value = 1}
            check_variable = { which = "wizlvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_wiz_attack_cantrip" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_wiz_attack_cantrip" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_wiz_attack_cantrip" }
            }
        }
        hidden_tooltip = { 
            change_variable = { which = "wizxp" value = 5}
            change_variable = { which = "spells_wizard" value = -1}
            set_character_flag = wizard_attack_cantrip
            character_event = { id = duelengine.4 }
        }
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_WIZARD_DEFEND_CANTRIP-COUNTER"
        custom_tooltip = {
            text = ACTION_WIZARD_DEFEND_CANTRIP-COUNTER_TOOLTIP
        }
        trigger = {
            check_variable = { which = "spells_wizard" value = 1}
            check_variable = { which = "wizlvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_wiz_defend_cantrip" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_wiz_defend_cantrip" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_wiz_defend_cantrip" }
            }
        }
        hidden_tooltip = { 
            change_variable = { which = "spells_wizard" value = -1}
            change_variable = { which = "wizxp" value = 5}
            set_character_flag = wizard_defend_cantrip
            character_event = { id = duelengine.4 }
        }
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_WIZARD_STONE-SKIN_CANTRIP-BUFF"
        custom_tooltip = {
            text = ACTION_WIZARD_STONE-SKIN_CANTRIP-BUFF_TOOLTIP
        }
        trigger = {
            check_variable = { which = "spells_wizard" value = 3}
            check_variable = { which = "wizlvl" value = 15}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_wiz_stone_skin_cantrip" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_wiz_stone_skin_cantrip" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_wiz_stone_skin_cantrip" }
            }
        }
        hidden_tooltip = { 
            change_variable = { which = "spells_wizard" value = -3}
            change_variable = { which = "wizxp" value = 5}
            set_character_flag = wizard_stone_skin_cantrip
            character_event = { id = duelengine.4 }
        }
        ai_chance = { factor = 0 }      
    }
     
    #This action exits the special menu, and returns to the default duel action menu.
    option = {
        name = "ACTION_PREVIOUS_MENU"
        trigger = {
            or = {
                check_variable = { which = "local_action_picked" which == "local_d_action_previous_menu" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_d_action_previous_menu" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_d_action_previous_menu" }
            } 
        }
        hidden_tooltip = { character_event = { id = duelaction.1 }}
        ai_chance = { factor = 0 }      
    } 
}

#Sorcerer Spell Book Menu
character_event = { 
    id = duelaction.20002
    desc = "EVTDESC_DUELACTION_SORCERER"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #This code executes everytime this event is called. It takes the current action number and adds two, and sets this variable to determine the three event options that should be selectable.
    immediate = { 
        z_sorc_setup = yes
        set_variable = { which = "local_action_picked_plus_one" which = "local_action_picked"}
        change_variable = { which = "local_action_picked_plus_one" value = "1"}
        set_variable = { which = "local_action_picked_plus_two" which = "local_action_picked_plus_one"}
        change_variable = { which = "local_action_picked_plus_two" value = "1"}
        if = { 
            limit = { 
                check_variable = { which = local_action_picked_plus_one which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_one value = 1}
            set_variable = { which = local_action_picked_plus_two value = 2}
        }
        else_if = { 
            limit = {
                check_variable = { which = local_action_picked_plus_two which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_two value = 1}
        }
    }
    option = {
        name = "NEXT_ACTION"
        if = { 
            limit = { 
                check_variable = { which = "local_action_picked" which >= "local_action_nr" } 
            }
            set_variable = { which = "local_action_picked" value = 1 } # circular menu
            hidden_tooltip = { repeat_event = { id = duelaction.20003 }}
        }
        else_if = {
            limit = {  
                check_variable = { which = "local_action_picked" which < "local_action_nr" } 
            }
            change_variable = { which = "local_action_picked" value = 3 }
            if = { 
                limit = { 
                    check_variable = { which = "local_action_picked" which > "local_action_nr" } 
                }
                set_variable = { which = "local_action_picked" value = 1 } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = duelaction.20003 }}
        }
        ai_chance = { factor = 1 }
    }
    option = {
        name = "ACTION_SORCERER_ATTACK_CANTRIP-ATTACK"
        custom_tooltip = {
            text = ACTION_SORCERER_ATTACK_CANTRIP-ATTACK_TOOLTIP
        }
        trigger = {
            check_variable = { which = "spells_sorcerer" value = 1}
            check_variable = { which = "sorclvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_sorc_attack_cantrip" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_sorc_attack_cantrip" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_sorc_attack_cantrip" }
            }
        }
        #hidden_tooltip = { 
            change_variable = { which = "sorcxp" value = 5}
            change_variable = { which = "spells_sorcerer" value = -1}
            set_character_flag = sorcerer_attack_cantrip
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_SORCERER_DEFEND_CANTRIP-COUNTER"
        custom_tooltip = {
            text = ACTION_SORCERER_DEFEND_CANTRIP-COUNTER_TOOLTIP
        }
        trigger = {
            check_variable = { which = "spells_sorcerer" value = 1}
            check_variable = { which = "sorclvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_sorc_defend_cantrip" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_sorc_defend_cantrip" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_sorc_defend_cantrip" }
            }
        }
        #hidden_tooltip = { 
            change_variable = { which = "spells_sorcerer" value = -1}
            change_variable = { which = "sorcxp" value = 5}
            set_character_flag = sorcerer_defend_cantrip
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
     
    #This action exits the special menu, and returns to the default duel action menu.
    option = {
        name = "ACTION_PREVIOUS_MENU"
        trigger = {
            or = {
                check_variable = { which = "local_action_picked" which == "local_d_action_previous_menu" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_d_action_previous_menu" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_d_action_previous_menu" }
            } 
        }
        hidden_tooltip = { character_event = { id = duelaction.1 }}
        ai_chance = { factor = 0 }      
    } 
}

#Bard Spell Book Menu
character_event = { 
    id = duelaction.20003
    desc = "EVTDESC_DUELACTION_BARD"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #This code executes everytime this event is called. It takes the current action number and adds two, and sets this variable to determine the three event options that should be selectable.
    immediate = { 
        z_bard_setup = yes
        set_variable = { which = "local_action_picked_plus_one" which = "local_action_picked"}
        change_variable = { which = "local_action_picked_plus_one" value = "1"}
        set_variable = { which = "local_action_picked_plus_two" which = "local_action_picked_plus_one"}
        change_variable = { which = "local_action_picked_plus_two" value = "1"}
        if = { 
            limit = { 
                check_variable = { which = local_action_picked_plus_one which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_one value = 1}
            set_variable = { which = local_action_picked_plus_two value = 2}
        }
        else_if = { 
            limit = {
                check_variable = { which = local_action_picked_plus_two which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_two value = 1}
        }
    }
    option = {
        name = "NEXT_ACTION"
        if = { 
            limit = { 
                check_variable = { which = "local_action_picked" which >= "local_action_nr" } 
            }
            set_variable = { which = "local_action_picked" value = 1 } # circular menu
            hidden_tooltip = { repeat_event = { id = duelaction.20003 }}
        }
        else_if = {
            limit = {  
                check_variable = { which = "local_action_picked" which < "local_action_nr" } 
            }
            change_variable = { which = "local_action_picked" value = 3 }
            if = { 
                limit = { 
                    check_variable = { which = "local_action_picked" which > "local_action_nr" } 
                }
                set_variable = { which = "local_action_picked" value = 1 } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = duelaction.20003 }}
        }
        ai_chance = { factor = 1 }
    }
    option = {
        name = "ACTION_BARD_DIRE_SONG-DEBUFF"
        custom_tooltip = {
            text = ACTION_BARD_DIRE_SONG-DEBUFF_TOOLTIP
        }
        trigger = {
            check_variable = { which = "spells_bard" value = 1}
            check_variable = { which = "bardlvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_bard_diresong" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_bard_diresong" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_bard_diresong" }
            }
        }   
        #hidden_tooltip = { 
            change_variable = {which = "spells_bard" value = -1}
            change_variable = { which = "bardxp" value = 5}           
            set_character_flag = bard_dire_song
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_BARD_EMBOLDENING_SONG-BUFF"
        custom_tooltip = {
            text = ACTION_BARD_EMBOLDENING_SONG-BUFF_TOOLTIP
        }
        trigger = {
            check_variable = { which = "spells_bard" value = 3}
            check_variable = { which = "bardlvl" value = 2}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_bard_emboldeningsong" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_bard_emboldeningsong" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_bard_emboldeningsong" }
            }
        }   
        #hidden_tooltip = { 
            change_variable = { which = "spells_bard" value = -3}
            change_variable = { which = "bardxp" value = 5}         
            set_character_flag = bard_embolden_song
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
     
    #This action exits the special menu, and returns to the default duel action menu.
    option = {
        name = "ACTION_PREVIOUS_MENU"
        trigger = {
            or = {
                check_variable = { which = "local_action_picked" which == "local_d_action_previous_menu" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_d_action_previous_menu" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_d_action_previous_menu" }
            } 
        }
        hidden_tooltip = { character_event = { id = duelaction.1 }}
        ai_chance = { factor = 0 }      
    } 
}

#Warlock Spell Book Menu
character_event = { 
    id = duelaction.20004
    desc = "EVTDESC_DUELACTION_WARLOCK"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #This code executes everytime this event is called. It takes the current action number and adds two, and sets this variable to determine the three event options that should be selectable.
    immediate = { 
        z_warl_setup = yes
        set_variable = { which = "local_action_picked_plus_one" which = "local_action_picked"}
        change_variable = { which = "local_action_picked_plus_one" value = "1"}
        set_variable = { which = "local_action_picked_plus_two" which = "local_action_picked_plus_one"}
        change_variable = { which = "local_action_picked_plus_two" value = "1"}
        if = { 
            limit = { 
                check_variable = { which = local_action_picked_plus_one which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_one value = 1}
            set_variable = { which = local_action_picked_plus_two value = 2}
        }
        else_if = { 
            limit = {
                check_variable = { which = local_action_picked_plus_two which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_two value = 1}
        }
    }
    option = {
        name = "NEXT_ACTION"
        if = { 
            limit = { 
                check_variable = { which = "local_action_picked" which >= "local_action_nr" } 
            }
            set_variable = { which = "local_action_picked" value = 1 } # circular menu
            hidden_tooltip = { repeat_event = { id = duelaction.20004 }}
        }
        else_if = {
            limit = {  
                check_variable = { which = "local_action_picked" which < "local_action_nr" } 
            }
            change_variable = { which = "local_action_picked" value = 3 }
            if = { 
                limit = { 
                    check_variable = { which = "local_action_picked" which > "local_action_nr" } 
                }
                set_variable = { which = "local_action_picked" value = 1 } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = duelaction.20004 }}
        }
        ai_chance = { factor = 1 }
    }
    option = {
        name = "ACTION_WARLOCK_DOOM_BLAST_CANTRIP-ATTACK"
        custom_tooltip = {
            text = ACTION_WARLOCK_DOOM_BLAST_CANTRIP-ATTACK_TOOLTIP
        }
        trigger = {
            check_variable = { which = "spells_warlock" value = 1}
            check_variable = { which = "warllvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_warl_doomblast_cantrip" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_warl_doomblast_cantrip" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_warl_doomblast_cantrip" }
            }
        }   
        #hidden_tooltip = { 
            change_variable = { which = "spells_warlock" value = -1}
            change_variable = { which = "warlxp" value = 5}           
            set_character_flag = warlock_doom_blast_cantrip
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_WARLOCK_DOOMFIRE_CANTRIP-ATTACK"
        custom_tooltip = {
            text = ACTION_WARLOCK_DOOMFIRE_CANTRIP-ATTACK_TOOLTIP
        }
        trigger = {
            check_variable = { which = "spells_warlock" value = 1}
            check_variable = { which = "warllvl" value = 3}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_warl_doomfire_cantrip" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_warl_doomfire_cantrip" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_warl_doomfire_cantrip" }
            }
        }   
        #hidden_tooltip = { 
            change_variable = {which = "spells_warlock" value = -1}
            change_variable = { which = "warlxp" value = 5}           
            set_character_flag = warlock_doomfire_cantrip
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }    
     
    #This action exits the special menu, and returns to the default duel action menu.
    option = {
        name = "ACTION_PREVIOUS_MENU"
        trigger = {
            or = {
                check_variable = { which = "local_action_picked" which == "local_d_action_previous_menu" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_d_action_previous_menu" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_d_action_previous_menu" }
            } 
        }
        hidden_tooltip = { character_event = { id = duelaction.1 }}
        ai_chance = { factor = 0 }      
    } 
}

#Cleric Spell Book Menu
character_event = { 
    id = duelaction.20005
    desc = "EVTDESC_DUELACTION_2"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #This code executes everytime this event is called. It takes the current action number and adds two, and sets this variable to determine the three event options that should be selectable.
    immediate = { 
        z_cler_setup = yes
        set_variable = { which = "local_action_picked_plus_one" which = "local_action_picked"}
        change_variable = { which = "local_action_picked_plus_one" value = "1"}
        set_variable = { which = "local_action_picked_plus_two" which = "local_action_picked_plus_one"}
        change_variable = { which = "local_action_picked_plus_two" value = "1"}
        if = { 
            limit = { 
                check_variable = { which = local_action_picked_plus_one which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_one value = 1}
            set_variable = { which = local_action_picked_plus_two value = 2}
        }
        else_if = { 
            limit = {
                check_variable = { which = local_action_picked_plus_two which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_two value = 1}
        }
    }
    option = {
        name = "NEXT_ACTION"
        if = { 
            limit = { 
                check_variable = { which = "local_action_picked" which >= "local_action_nr" } 
            }
            set_variable = { which = "local_action_picked" value = 1 } # circular menu
            hidden_tooltip = { repeat_event = { id = duelaction.2 }}
        }
        else_if = {
            limit = {  
                check_variable = { which = "local_action_picked" which < "local_action_nr" } 
            }
            change_variable = { which = "local_action_picked" value = 3 }
            if = { 
                limit = { 
                    check_variable = { which = "local_action_picked" which > "local_action_nr" } 
                }
                set_variable = { which = "local_action_picked" value = 1 } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = duelaction.2 }}
        }
        ai_chance = { factor = 1 }
    }
    option = {
        name = "ACTION_CLERIC_HEALING_CANTRIP-HEAL"
        custom_tooltip = {
            text = ACTION_CLERIC_HEALING_CANTRIP-HEAL_TOOLTIP
        }
        trigger = {
            check_variable = { which = "spells_cleric" value = 1}
            check_variable = { which = "clerlvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_cler_heal_cantrip" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_cler_heal_cantrip" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_cler_heal_cantrip" }
            }
        }   
        hidden_tooltip = { 
            change_variable = { which = "spells_cleric" value = -1}
            change_variable = { which = "clerxp" value = 5}           
            set_character_flag = cleric_heal_cantrip
            character_event = { id = duelengine.4 }
        }
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_CLERIC_DIVINE_BLESSING-BUFF"
        custom_tooltip = {
            text = ACTION_CLERIC_DIVINE_BLESSING-BUFF_TOOLTIP
        }
        trigger = {
            check_variable = { which = "spells_cleric" value = 3}
            check_variable = { which = "clerlvl" value = 3}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_cler_divine_blessing" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_cler_divine_blessing" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_cler_divine_blessing" }
            }
        }   
        hidden_tooltip = { 
            change_variable = { which = "spells_cleric" value = -3}
            change_variable = { which = "clerxp" value = 5}           
            set_character_flag = cleric_divine_blessing
            character_event = { id = duelengine.4 }
        }
        ai_chance = { factor = 0 }      
    }
     
    #This action exits the special menu, and returns to the default duel action menu.
    option = {
        name = "ACTION_PREVIOUS_MENU"
        trigger = {
            or = {
                check_variable = { which = "local_action_picked" which == "local_d_action_previous_menu" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_d_action_previous_menu" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_d_action_previous_menu" }
            } 
        }
        hidden_tooltip = { character_event = { id = duelaction.1 }}
        ai_chance = { factor = 0 }      
    } 
}

#Druid Spell Book Menu
character_event = { 
    id = duelaction.20006
    desc = "EVTDESC_DUELACTION_2"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #This code executes everytime this event is called. It takes the current action number and adds two, and sets this variable to determine the three event options that should be selectable.
    immediate = { 
        z_drui_setup = yes
        set_variable = { which = "local_action_picked_plus_one" which = "local_action_picked"}
        change_variable = { which = "local_action_picked_plus_one" value = "1"}
        set_variable = { which = "local_action_picked_plus_two" which = "local_action_picked_plus_one"}
        change_variable = { which = "local_action_picked_plus_two" value = "1"}
        if = { 
            limit = { 
                check_variable = { which = local_action_picked_plus_one which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_one value = 1}
            set_variable = { which = local_action_picked_plus_two value = 2}
        }
        else_if = { 
            limit = {
                check_variable = { which = local_action_picked_plus_two which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_two value = 1}
        }
    }
    option = {
        name = "NEXT_ACTION"
        if = { 
            limit = { 
                check_variable = { which = "local_action_picked" which >= "local_action_nr" } 
            }
            set_variable = { which = "local_action_picked" value = 1 } # circular menu
            hidden_tooltip = { repeat_event = { id = duelaction.2 }}
        }
        else_if = {
            limit = {  
                check_variable = { which = "local_action_picked" which < "local_action_nr" } 
            }
            change_variable = { which = "local_action_picked" value = 3 }
            if = { 
                limit = { 
                    check_variable = { which = "local_action_picked" which > "local_action_nr" } 
                }
                set_variable = { which = "local_action_picked" value = 1 } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = duelaction.2 }}
        }
        ai_chance = { factor = 1 }
    }
    option = {
        name = "ACTION_DRUID_BEAR_STRIKE-ATTACK"
        trigger = {
            check_variable = { which = "spells_druid" value = 1}
            check_variable = { which = "druilvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_drui_bear_strike" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_drui_bear_strike" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_drui_bear_strike" }
            }
        }   
        #hidden_tooltip = { 
            change_variable = {which = "spells_druid" value = -1}
            change_variable = { which = "druixp" value = 5}           
            set_character_flag = druid_bear_strike
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_DRUID_REGROWTH"
        trigger = {
            check_variable = { which = "spells_druid" value = 3}
            check_variable = { which = "druilvl" value = 3}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_drui_regrowth" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_drui_regrowth" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_drui_regrowth" }
            }
        }   
        #hidden_tooltip = { 
            change_variable = {which = "spells_druid" value = -3}
            change_variable = { which = "druixp" value = 5}           
            set_character_flag = druid_regrowth
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_DRUID_BEAR_SKIN"
        trigger = {
            check_variable = { which = "spells_druid" value = 5}
            check_variable = { which = "druilvl" value = 5}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_drui_bear_skin" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_drui_bear_skin" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_drui_bear_skin" }
            }
        }   
        #hidden_tooltip = { 
            change_variable = {which = "spells_druid" value = -5}
            change_variable = { which = "druixp" value = 5}           
            set_character_flag = druid_bear_skin
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }     
    #This action exits the special menu, and returns to the default duel action menu.
    option = {
        name = "ACTION_PREVIOUS_MENU"
        trigger = {
            or = {
                check_variable = { which = "local_action_picked" which == "local_d_action_previous_menu" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_d_action_previous_menu" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_d_action_previous_menu" }
            } 
        }
        hidden_tooltip = { character_event = { id = duelaction.1 }}
        ai_chance = { factor = 0 }      
    } 
}

#Paladin Spell Book Menu
character_event = { 
    id = duelaction.20007
    desc = "EVTDESC_DUELACTION_2"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #This code executes everytime this event is called. It takes the current action number and adds two, and sets this variable to determine the three event options that should be selectable.
    immediate = { 
        z_paladin_setup = yes
        set_variable = { which = "local_action_picked_plus_one" which = "local_action_picked"}
        change_variable = { which = "local_action_picked_plus_one" value = "1"}
        set_variable = { which = "local_action_picked_plus_two" which = "local_action_picked_plus_one"}
        change_variable = { which = "local_action_picked_plus_two" value = "1"}
        if = { 
            limit = { 
                check_variable = { which = local_action_picked_plus_one which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_one value = 1}
            set_variable = { which = local_action_picked_plus_two value = 2}
        }
        else_if = { 
            limit = {
                check_variable = { which = local_action_picked_plus_two which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_two value = 1}
        }
    }
    option = {
        name = "NEXT_ACTION"
        if = { 
            limit = { 
                check_variable = { which = "local_action_picked" which >= "local_action_nr" } 
            }
            set_variable = { which = "local_action_picked" value = 1 } # circular menu
            hidden_tooltip = { repeat_event = { id = duelaction.20007 }}
        }
        else_if = {
            limit = {  
                check_variable = { which = "local_action_picked" which < "local_action_nr" } 
            }
            change_variable = { which = "local_action_picked" value = 3 }
            if = { 
                limit = { 
                    check_variable = { which = "local_action_picked" which > "local_action_nr" } 
                }
                set_variable = { which = "local_action_picked" value = 1 } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = duelaction.20007 }}
        }
        ai_chance = { factor = 1 }
    }
    option = {
        name = "ACTION_PALADIN_HOLY_SMITE"
        trigger = {
            check_variable = { which = "spells_paladin" value = 1}
            check_variable = { which = "palalvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_pala_holy_smite" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_pala_holy_smite" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_pala_holy_smite" }
            }
        }   
        #hidden_tooltip = { 
            change_variable = {which = "spells_paladin" value = -1}
            change_variable = { which = "palaxp" value = 5}           
            set_character_flag = paladin_holy_smite
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_PALADIN_CURATIVE"
        trigger = {
            check_variable = { which = "spells_paladin" value = 3}
            check_variable = { which = "palalvl" value = 2}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_pala_curative" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_pala_curative" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_pala_curative" }
            }
        }   
        #hidden_tooltip = { 
            change_variable = {which = "spells_paladin" value = -3}
            change_variable = { which = "palaxp" value = 5}           
            set_character_flag = paladin_curative
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_PALADIN_LARGER_THAN_LIFE"
        trigger = {
            check_variable = { which = "spells_paladin" value = 5}
            check_variable = { which = "palalvl" value = 7}
            or = {
            }                check_variable = { which = "local_action_picked" which == "local_m_action_pala_larger_than_life" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_pala_larger_than_life" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_pala_larger_than_life" }

        }   
        #hidden_tooltip = { 
            change_variable = {which = "spells_paladin" value = -3}
            change_variable = { which = "palaxp" value = 5}           
            set_character_flag = paladin_larger_than_life
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
    option = {
        name = "ACTION_PALADIN_DIVINE_LIGHT"
        trigger = {
            check_variable = { which = "spells_paladin" value = 1}
            check_variable = { which = "palalvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_cle_heal_cantrip" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_cle_heal_cantrip" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_cle_heal_cantrip" }
            }
        }   
        #hidden_tooltip = { 
            change_variable = {which = "spells_paladin" value = -1}
            change_variable = { which = "palaxp" value = 5}           
            set_character_flag = paladin_divine_light
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    } 
     
    #This action exits the special menu, and returns to the default duel action menu.
    option = {
        name = "ACTION_PREVIOUS_MENU"
        trigger = {
            or = {
                check_variable = { which = "local_action_picked" which == "local_d_action_previous_menu" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_d_action_previous_menu" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_d_action_previous_menu" }
            } 
        }
        hidden_tooltip = { character_event = { id = duelaction.1 }}
        ai_chance = { factor = 0 }      
    } 
}

#Fighter Ability Menu
character_event = { 
    id = duelaction.20008
    desc = "EVTDESC_DUELACTION_FIGHTER"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #This code executes everytime this event is called. It takes the current action number and adds two, and sets this variable to determine the three event options that should be selectable.
    immediate = { 
        set_variable = { which = "local_action_picked_plus_one" which = "local_action_picked"}
        change_variable = { which = "local_action_picked_plus_one" value = "1"}
        set_variable = { which = "local_action_picked_plus_two" which = "local_action_picked_plus_one"}
        change_variable = { which = "local_action_picked_plus_two" value = "1"}
        if = { 
            limit = { 
                check_variable = { which = local_action_picked_plus_one which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_one value = 1}
            set_variable = { which = local_action_picked_plus_two value = 2}
        }
        else_if = { 
            limit = {
                check_variable = { which = local_action_picked_plus_two which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_two value = 1}
        }
    }
    option = {
        name = "NEXT_ACTION"
        if = { 
            limit = { 
                check_variable = { which = "local_action_picked" which >= "local_action_nr" } 
            }
            set_variable = { which = "local_action_picked" value = 1 } # circular menu
            hidden_tooltip = { repeat_event = { id = duelaction.20008 }}
        }
        else_if = {
            limit = {  
                check_variable = { which = "local_action_picked" which < "local_action_nr" } 
            }
            change_variable = { which = "local_action_picked" value = 3 }
            if = { 
                limit = { 
                    check_variable = { which = "local_action_picked" which > "local_action_nr" } 
                }
                set_variable = { which = "local_action_picked" value = 1 } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = duelaction.20008 }}
        }
        ai_chance = { factor = 1 }
    }
    option = {
        name = "ACTION_FIGHTER_PARRY"
        trigger = {
            check_variable = { which = "abilities_fighter" value = 1}
            check_variable = { which = "fighlvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_figh_parry" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_figh_parry" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_figh_parry" }
            }
        }   
        #hidden_tooltip = { 
            z_fighter_setup = yes
            change_variable = {which = "abilities_fighter" value = -1}
            change_variable = { which = "fighxp" value = 5}           
            set_character_flag = fighter_parry
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
 
    #This action exits the special menu, and returns to the default duel action menu.
    option = {
        name = "ACTION_PREVIOUS_MENU"
        trigger = {
            or = {
                check_variable = { which = "local_action_picked" which == "local_d_action_previous_menu" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_d_action_previous_menu" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_d_action_previous_menu" }
            } 
        }
        hidden_tooltip = { character_event = { id = duelaction.1 }}
        ai_chance = { factor = 0 }      
    } 
}

#Ranger Ability Menu
character_event = { 
    id = duelaction.20009
    desc = "EVTDESC_DUELACTION_FIGHTER"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #This code executes everytime this event is called. It takes the current action number and adds two, and sets this variable to determine the three event options that should be selectable.
    immediate = { 
        z_ranger_setup = yes
        set_variable = { which = "local_action_picked_plus_one" which = "local_action_picked"}
        change_variable = { which = "local_action_picked_plus_one" value = "1"}
        set_variable = { which = "local_action_picked_plus_two" which = "local_action_picked_plus_one"}
        change_variable = { which = "local_action_picked_plus_two" value = "1"}
        if = { 
            limit = { 
                check_variable = { which = local_action_picked_plus_one which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_one value = 1}
            set_variable = { which = local_action_picked_plus_two value = 2}
        }
        else_if = { 
            limit = {
                check_variable = { which = local_action_picked_plus_two which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_two value = 1}
        }
    }
    option = {
        name = "NEXT_ACTION"
        if = { 
            limit = { 
                check_variable = { which = "local_action_picked" which >= "local_action_nr" } 
            }
            set_variable = { which = "local_action_picked" value = 1 } # circular menu
            hidden_tooltip = { repeat_event = { id = duelaction.20009 }}
        }
        else_if = {
            limit = {  
                check_variable = { which = "local_action_picked" which < "local_action_nr" } 
            }
            change_variable = { which = "local_action_picked" value = 3 }
            if = { 
                limit = { 
                    check_variable = { which = "local_action_picked" which > "local_action_nr" } 
                }
                set_variable = { which = "local_action_picked" value = 1 } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = duelaction.20009 }}
        }
        ai_chance = { factor = 1 }
    }
    option = {
        name = "ACTION_RANGER_PARRY"
        trigger = {
            check_variable = { which = "abilities_ranger" value = 1}
            check_variable = { which = "ranglvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_rang_parry" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_rang_parry" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_rang_parry" }
            }
        }   
        #hidden_tooltip = { 
            change_variable = {which = "abilities_ranger" value = -1}
            change_variable = { which = "rangxp" value = 5}           
            set_character_flag = ranger_parry
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
 
    #This action exits the special menu, and returns to the default duel action menu.
    option = {
        name = "ACTION_PREVIOUS_MENU"
        trigger = {
            or = {
                check_variable = { which = "local_action_picked" which == "local_d_action_previous_menu" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_d_action_previous_menu" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_d_action_previous_menu" }
            } 
        }
        hidden_tooltip = { character_event = { id = duelaction.1 }}
        ai_chance = { factor = 0 }      
    } 
}

#Barbarian Ability Menu
character_event = { 
    id = duelaction.20010
    desc = "EVTDESC_DUELACTION_FIGHTER"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #This code executes everytime this event is called. It takes the current action number and adds two, and sets this variable to determine the three event options that should be selectable.
    immediate = { 
        z_barbarian_setup = yes
        set_variable = { which = "local_action_picked_plus_one" which = "local_action_picked"}
        change_variable = { which = "local_action_picked_plus_one" value = "1"}
        set_variable = { which = "local_action_picked_plus_two" which = "local_action_picked_plus_one"}
        change_variable = { which = "local_action_picked_plus_two" value = "1"}
        if = { 
            limit = { 
                check_variable = { which = local_action_picked_plus_one which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_one value = 1}
            set_variable = { which = local_action_picked_plus_two value = 2}
        }
        else_if = { 
            limit = {
                check_variable = { which = local_action_picked_plus_two which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_two value = 1}
        }
    }
    option = {
        name = "NEXT_ACTION"
        if = { 
            limit = { 
                check_variable = { which = "local_action_picked" which >= "local_action_nr" } 
            }
            set_variable = { which = "local_action_picked" value = 1 } # circular menu
            hidden_tooltip = { repeat_event = { id = duelaction.20010 }}
        }
        else_if = {
            limit = {  
                check_variable = { which = "local_action_picked" which < "local_action_nr" } 
            }
            change_variable = { which = "local_action_picked" value = 3 }
            if = { 
                limit = { 
                    check_variable = { which = "local_action_picked" which > "local_action_nr" } 
                }
                set_variable = { which = "local_action_picked" value = 1 } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = duelaction.20010 }}
        }
        ai_chance = { factor = 1 }
    }
    option = {
        name = "ACTION_BARBARIAN_PARRY"
        trigger = {
            check_variable = { which = "abilities_barbarian" value = 1}
            check_variable = { which = "barblvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_barb_parry" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_barb_parry" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_barb_parry" }
            }
        }   
        #hidden_tooltip = { 
            change_variable = {which = "abilities_barbarian" value = -1}
            change_variable = { which = "barbxp" value = 5}           
            set_character_flag = barbarian_parry
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
 
    #This action exits the special menu, and returns to the default duel action menu.
    option = {
        name = "ACTION_PREVIOUS_MENU"
        trigger = {
            or = {
                check_variable = { which = "local_action_picked" which == "local_d_action_previous_menu" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_d_action_previous_menu" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_d_action_previous_menu" }
            } 
        }
        hidden_tooltip = { character_event = { id = duelaction.1 }}
        ai_chance = { factor = 0 }      
    } 
}

#Rogue Ability Menu
character_event = { 
    id = duelaction.20011
    desc = "EVTDESC_DUELACTION_RANGER"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #This code executes everytime this event is called. It takes the current action number and adds two, and sets this variable to determine the three event options that should be selectable.
    immediate = { 
        set_variable = { which = "local_action_picked_plus_one" which = "local_action_picked"}
        change_variable = { which = "local_action_picked_plus_one" value = "1"}
        set_variable = { which = "local_action_picked_plus_two" which = "local_action_picked_plus_one"}
        change_variable = { which = "local_action_picked_plus_two" value = "1"}
        if = { 
            limit = { 
                check_variable = { which = local_action_picked_plus_one which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_one value = 1}
            set_variable = { which = local_action_picked_plus_two value = 2}
        }
        else_if = { 
            limit = {
                check_variable = { which = local_action_picked_plus_two which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_two value = 1}
        }
    }
    option = {
        name = "NEXT_ACTION"
        if = { 
            limit = { 
                check_variable = { which = "local_action_picked" which >= "local_action_nr" } 
            }
            set_variable = { which = "local_action_picked" value = 1 } # circular menu
            hidden_tooltip = { repeat_event = { id = duelaction.20011 }}
        }
        else_if = {
            limit = {  
                check_variable = { which = "local_action_picked" which < "local_action_nr" } 
            }
            change_variable = { which = "local_action_picked" value = 3 }
            if = { 
                limit = { 
                    check_variable = { which = "local_action_picked" which > "local_action_nr" } 
                }
                set_variable = { which = "local_action_picked" value = 1 } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = duelaction.20011 }}
        }
        ai_chance = { factor = 1 }
    }
    option = {
        name = "ACTION_ROGUE_DODGE"
        trigger = {
            check_variable = { which = "abilities_rogue" value = 1}
            check_variable = { which = "rogulvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_rogu_dodge" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_rogu_dodge" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_rogu_dodge" }
            }
        }   
        #hidden_tooltip = { 
            z_rogue_setup = yes
            change_variable = {which = "abilities_rogu" value = -1}
            change_variable = { which = "roguxp" value = 5}           
            set_character_flag = rogue_dodge
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
 
    #This action exits the special menu, and returns to the default duel action menu.
    option = {
        name = "ACTION_PREVIOUS_MENU"
        trigger = {
            or = {
                check_variable = { which = "local_action_picked" which == "local_d_action_previous_menu" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_d_action_previous_menu" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_d_action_previous_menu" }
            } 
        }
        hidden_tooltip = { character_event = { id = duelaction.1 }}
        ai_chance = { factor = 0 }      
    } 
}

#Assassin Ability Menu
character_event = { 
    id = duelaction.20012
    desc = "EVTDESC_DUELACTION_ASSASSIN"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #This code executes everytime this event is called. It takes the current action number and adds two, and sets this variable to determine the three event options that should be selectable.
    immediate = { 
        set_variable = { which = "local_action_picked_plus_one" which = "local_action_picked"}
        change_variable = { which = "local_action_picked_plus_one" value = "1"}
        set_variable = { which = "local_action_picked_plus_two" which = "local_action_picked_plus_one"}
        change_variable = { which = "local_action_picked_plus_two" value = "1"}
        if = { 
            limit = { 
                check_variable = { which = local_action_picked_plus_one which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_one value = 1}
            set_variable = { which = local_action_picked_plus_two value = 2}
        }
        else_if = { 
            limit = {
                check_variable = { which = local_action_picked_plus_two which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_two value = 1}
        }
    }
    option = {
        name = "NEXT_ACTION"
        if = { 
            limit = { 
                check_variable = { which = "local_action_picked" which >= "local_action_nr" } 
            }
            set_variable = { which = "local_action_picked" value = 1 } # circular menu
            hidden_tooltip = { repeat_event = { id = duelaction.20012 }}
        }
        else_if = {
            limit = {  
                check_variable = { which = "local_action_picked" which < "local_action_nr" } 
            }
            change_variable = { which = "local_action_picked" value = 3 }
            if = { 
                limit = { 
                    check_variable = { which = "local_action_picked" which > "local_action_nr" } 
                }
                set_variable = { which = "local_action_picked" value = 1 } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = duelaction.20012 }}
        }
        ai_chance = { factor = 1 }
    }
    option = {
        name = "ACTION_ASSASSIN_DODGE"
        trigger = {
            check_variable = { which = "abilities_assassin" value = 1}
            check_variable = { which = "assalvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_assa_dodge" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_assa_dodge" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_assa_dodge" }
            }
        }   
        hidden_tooltip = { 
            z_asssassin_setup = yes
            change_variable = {which = "abilities_assassin" value = -1}
            change_variable = { which = "assaxp" value = 5}           
            set_character_flag = assassin_dodge
            character_event = { id = duelengine.4 }
        }
        ai_chance = { factor = 0 }      
    }
 
    #This action exits the special menu, and returns to the default duel action menu.
    option = {
        name = "ACTION_PREVIOUS_MENU"
        trigger = {
            or = {
                check_variable = { which = "local_action_picked" which == "local_d_action_previous_menu" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_d_action_previous_menu" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_d_action_previous_menu" }
            } 
        }
        hidden_tooltip = { character_event = { id = duelaction.1 }}
        ai_chance = { factor = 0 }      
    } 
}

#Shadow Ability Menu
character_event = { 
    id = duelaction.20013
    desc = "EVTDESC_DUELACTION_SHADOW"
    picture = "GFX_evt_generic_duel"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_spellbook
    #This code executes everytime this event is called. It takes the current action number and adds two, and sets this variable to determine the three event options that should be selectable.
    immediate = { 
        set_variable = { which = "local_action_picked_plus_one" which = "local_action_picked"}
        change_variable = { which = "local_action_picked_plus_one" value = "1"}
        set_variable = { which = "local_action_picked_plus_two" which = "local_action_picked_plus_one"}
        change_variable = { which = "local_action_picked_plus_two" value = "1"}
        if = { 
            limit = { 
                check_variable = { which = local_action_picked_plus_one which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_one value = 1}
            set_variable = { which = local_action_picked_plus_two value = 2}
        }
        else_if = { 
            limit = {
                check_variable = { which = local_action_picked_plus_two which > local_action_nr} 
            }
            set_variable = { which = local_action_picked_plus_two value = 1}
        }
    }
    option = {
        name = "NEXT_ACTION"
        if = { 
            limit = { 
                check_variable = { which = "local_action_picked" which >= "local_action_nr" } 
            }
            set_variable = { which = "local_action_picked" value = 1 } # circular menu
            hidden_tooltip = { repeat_event = { id = duelaction.20013 }}
        }
        else_if = {
            limit = {  
                check_variable = { which = "local_action_picked" which < "local_action_nr" } 
            }
            change_variable = { which = "local_action_picked" value = 3 }
            if = { 
                limit = { 
                    check_variable = { which = "local_action_picked" which > "local_action_nr" } 
                }
                set_variable = { which = "local_action_picked" value = 1 } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = duelaction.20013 }}
        }
        ai_chance = { factor = 1 }
    }
    option = {
        name = "ACTION_SHADOW_DODGE"
        trigger = {
            check_variable = { which = "abilities_shadow" value = 1}
            check_variable = { which = "shadlvl" value = 1}
            or = {
                check_variable = { which = "local_action_picked" which == "local_m_action_shad_dodge" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_m_action_shad_dodge" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_m_action_shad_dodge" }
            }
        }   
        #hidden_tooltip = { 
            z_shadow_setup = yes
            change_variable = {which = "abilities_shadow" value = -1}
            change_variable = { which = "shadxp" value = 5}           
            set_character_flag = shadow_dodge
            character_event = { id = duelengine.4 }
        #}
        ai_chance = { factor = 0 }      
    }
 
    #This action exits the special menu, and returns to the default duel action menu.
    option = {
        name = "ACTION_PREVIOUS_MENU"
        trigger = {
            or = {
                check_variable = { which = "local_action_picked" which == "local_d_action_previous_menu" } 
                check_variable = { which = "local_action_picked_plus_one" which == "local_d_action_previous_menu" }
                check_variable = { which = "local_action_picked_plus_two" which == "local_d_action_previous_menu" }
            } 
        }
        hidden_tooltip = { character_event = { id = duelaction.1 }}
        ai_chance = { factor = 0 }      
    } 
}


# ACTION EFFECTS CALCULAITON 
#
# This events takes into consideration the action declared by both characters
# and calculates final duel_att_mod and duel_def_mod values for the round
# triggered from outside by duelengine.4
# repeats itself for both characters



character_event = {
    id = duelaction.3
    hide_window = yes
    is_triggered_only = yes
   
    immediate = {  

        # RESOLVING COOLDOWNS
        #change_variable = { which = "duel_cooldown_block" value = -1 }
        #change_variable = { which = "duel_cooldown_dodge" value = -1 }
        clear_event_target = attacker
        clear_event_target = defender
        duel_round_before_attack_effect = yes

        # DON'T TOUCH AFTER THIS POINT
        if = {
            limit = { root = { character = event_target:charA}}
            log = "Resolved actions for charA (duelaction.3)"
            event_target:charA = { save_event_target_as = defender }
            event_target:charB = { save_event_target_as = attacker }
            # loop this event
            event_target:charB = { character_event = { id = duelaction.3 } }
        }
        if = {
            limit = { NOT = { root = { character = event_target:charA}} }
            # if calculations are done now is the time for reports
            log = "Resolved actions for charB (duelaction.3)"
            event_target:charA = { save_event_target_as = attacker }
            event_target:charB = { save_event_target_as = defender }
            #
            event_target:charA = { character_event = { id = duelengine.5 } }
        }
    }
}

# duelaction.4 
# here we decide which report will be triggered basing on character actions
# and round outcome
# ROOT = event_target:charB (always)
# remember ALWAYS SEND THE REPORT TO CHAR A (there are reasons for that)
# also since we use "break" instruction the order of IF statements DOES MATTER
character_event = {
    id = duelaction.4
    hide_window = yes
    is_triggered_only = yes
    
    immediate = {
      # FIXME
        event_target:charA = {
            z_duel_round_end_effect = yes
        }
        event_target:charB = {
            z_duel_round_end_effect = yes
        }

      if = { limit = { root = { character = event_target:charA}} log = "this is A" } 
      if = { limit = { NOT = { root = { character = event_target:charA}}} log = "this is B" }
      log = "Round finished reports are to be send"
      # FIXME

      # DUEL OUTCOME REPORTS
      if = {
          limit = { 
              event_target:charB = { NOT = { check_variable = { which = "duel_hp" value = 1 }}}
          }
          event_target:charA = { character_event = { id = duelaction.201 }} # we have been slain
          break = yes
      }
      if = {
          limit = { 
              event_target:charA = { NOT = { check_variable = { which = "duel_hp" value = 1 }}}
          }
          event_target:charA = { character_event = { id = duelaction.200 }} # enemy was slain
          break = yes
      }
      # GENERIC REPORT 
      event_target:charA = { character_event ={ id = duelaction.100 }}
    }
}




########################################################################
#
# REPORT EVENTS 
#
########################################################################
# For each pair of action (enemy and yours) there is a pair of report
# events.
#
# In first event from the pair ROOT = event_target:charA
#
# Second event may send to charA or charB
# in first case the first event is send to B  
# _simple right_?
#


# BOTH ATTACK
# 1st char
character_event = {
    id = duelaction.100
    window = zz_duel_narrative
    desc = "EVTDESC_DUELACTION_100"
    picture = "GFX_evt_duel2"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    immediate = { 
        event_target:charA = { 
            save_event_target_as = attackloc
        }
        event_target:charB = { 
            save_event_target_as = defendloc
        }
    }
    # charB got this event
    option = {
       name = "OK"
       trigger = { NOT = { root = { character = event_target:charA}} }
       log = "Reports were shown to both."
       event_target:charA = { 
        character_event = { id = duelengine.3 } } # next round
    }
    # charA got this event
    option = {
       name = "OK"
       trigger = { root = { character = event_target:charA} }
       event_target:charB = { character_event = { id = duelaction.101 } }
    }
}
# 2nd char
character_event =  {
    id = duelaction.101
    window = zz_duel_narrative
    desc = "EVTDESC_DUELACTION_101"
    picture = "GFX_evt_duel2"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes

    immediate = { 
        event_target:charB = { 
            save_event_target_as = attackloc
        }
        event_target:charA = { 
            save_event_target_as = defendloc
        }
    }
    # charB got this event
    option = {
       name = "OK"
       trigger = { NOT = { root = { character = event_target:charA}} }
       log = "Reports were shown to both."
       event_target:charA = { character_event = { id = duelengine.3 } } # next round
    }
    # charA got this event
    option = {
       name = "OK"
       trigger = { root = { character = event_target:charA} }
       event_target:charB = { character_event = { id = duelaction.100 } } # symmetric response
    }
}


########################################################################
#
# OUTCOME EVENTS 
#
########################################################################
#
# Range 200- x
#
# Those are special kind of report events 
# Triggered when somebody dies or something.
# You can set them in duelaction.4 event exactly the same way u
# set triggering of report events.
#
# in last the option that is last exectued please trigger
# duelengine.6 event to clear all duel variables and flags


# OUTCOME: DEATH OF ONE PERSON
# 1st event (for loser)
character_event = {
    id = duelaction.200
    desc = "EVTDESC_DUELACTION_200"
    picture = "GFX_evt_duel4"
    window = zz_duel_narrative
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes

    # charB got this event
    option = {
		name = "OK"
		trigger = { NOT = { root = { character = event_target:charA}} }
        hidden_effect = {
            log = "Outcome report was shown to both."
            if = {
                limit = {
                    or = {
                        is_invincible_trigger = yes
                        has_character_modifier = z_foresight_blessing_battle
                    }
                }
                antideath_effect = yes
                event_target:charA = { duel_engine_clear_all_data = yes } # clearing event
                event_target:charB = { duel_engine_clear_all_data = yes } # clearing event
                clr_character_flag = duel
                if = { 
                    limit = { 
                        has_character_modifier = z_foresight_blessing_battle
                    }
                    remove_character_modifier = z_foresight_blessing_battle
                }
                break = yes 
            }
            death = {
                death_reason = death_duel
                killer = event_target:charA
            }
            event_target:charA = { duel_engine_clear_all_data = yes } # clearing event
            event_target:charB = { duel_engine_clear_all_data = yes } # clearing event
            clr_character_flag = duel
        }
    }
    # charA got this event
    option = {
        name = "OK"
        hidden_effect = {
            if = {
                limit = {
                    is_invincible_trigger = yes
                }
                antideath_effect = yes
                event_target:charA = { duel_engine_clear_all_data = yes } # clearing event
                event_target:charB = { duel_engine_clear_all_data = yes } # clearing event
                clr_character_flag = duel
                break = yes 
            }
            death = {
                death_reason = death_duel
                killer = event_target:charB
            }
            trigger = { root = { character = event_target:charA} }
            event_target:charB = { character_event = { id = duelaction.201 } }
            event_target:charA = { duel_engine_clear_all_data = yes } # clearing event
            event_target:charB = { duel_engine_clear_all_data = yes } # clearing event
            clr_character_flag = duel
        }
    }
}
# 2nd char (for winner)
character_event = {
    id = duelaction.201
    desc = "EVTDESC_DUELACTION_201"
    picture = "GFX_evt_duel4"
    window = zz_duel_narrative
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes


    # charB got this event
    option = {
       name = "OK"
        trigger = { NOT = { root = { character = event_target:charA}} }
        hidden_effect = {
            log = "Outcome report was shown to both."
            event_target:charA = { duel_engine_clear_all_data = yes } # clearing event
            event_target:charB = { duel_engine_clear_all_data = yes } # clearing event
            clr_character_flag = duel
            #to add a reward to the duel sequence, edit the following scripted effect
            zz_duel_reward_sequence = yes
            #add xp gain event, and any special event checks. 
            #if = {
            #   limit = { has_character_flag = greenksin_bash_head_duel }
            #   remove_character_modifier = weak_warboss
            #   clr_character_flag = greenksin_bash_head_duel
            #   set_character_flag = weak_warboss_bashed_heads
            #}
    }
    }
    # charA got this event
    option = {
        name = "OK"
        trigger = { root = { character = event_target:charA} }
        hidden_effect = {
            event_target:charA = { duel_engine_clear_all_data = yes } # clearing event
            event_target:charB = { duel_engine_clear_all_data = yes } # clearing event
            clr_character_flag = duel
            #to add a reward to the duel sequence, edit the following scripted effect
            zz_duel_reward_sequence = yes
            #add xp gain event, and any special event checks. 
            #if = {
            #   limit = { has_character_flag = greenksin_bash_head_duel }
            #   remove_character_modifier = weak_warboss
            #   clr_character_flag = greenksin_bash_head_duel
            #   set_character_flag = weak_warboss_bashed_heads
            #}
        }
    }
}

# OUTCOME : Ran away
#


# The person who ran away
character_event = {
    id = duelaction.202
    desc = "EVTDESC_DUELACTION_202"
    picture = "GFX_evt_battle"
    border = "GFX_event_normal_frame_war"
    window = zz_duel_narrative
    is_triggered_only = yes
    
    # charB got this event
    option = {
        name = "OK"
        trigger = { NOT = { root = { character = event_target:charA}} }
        hidden_effect = { 
            log = "Outcome report was shown to both."
            event_target:charA = { character_event = { id = duelaction.203 } }
            event_target:charA = { duel_engine_clear_all_data = yes} # clearing event
            clr_character_flag = duel
        }
    }
    # charA got this event
    option = {
        name = "OK"
        trigger = { root = { character = event_target:charA} }
        hidden_effect = {
            event_target:charB = { character_event = { id = duelaction.203 } }
            event_target:charB = { duel_engine_clear_all_data = yes} # clearing event
            clr_character_flag = duel
        }
    }
}
# for the winner
character_event = {
    id = duelaction.203
    desc = "EVTDESC_DUELACTION_203"
    picture = "GFX_evt_battle"
    #border = GFX_event_normal_frame_war
    is_triggered_only = yes
    window = zz_duel_narrative


    # charB got this event
    option = {
        name = "OK"
        trigger = { root = { character = event_target:charA} }
        hidden_effect = {
            log = "Outcome report was shown to both."
            event_target:charA = { duel_engine_clear_all_data = yes } # clearing event
            event_target:charB = { duel_engine_clear_all_data = yes } # clearing event
            clr_character_flag = duel
            #to add a reward to the duel sequence, edit the following scripted effect
            zz_duel_reward_sequence = yes	   
            #add xp gain event, and any special event checks. 
            #if = {
            #   limit = { has_character_flag = greenksin_bash_head_duel }
            #   remove_character_modifier = weak_warboss
            #   clr_character_flag = greenksin_bash_head_duel
            #   set_character_flag = weak_warboss_bashed_heads
            #}
        }
    }
    # charA got this event
    option = {
        name = "OK"
        trigger = { 
            NOT = { 
                root = { character = event_target:charA}
            } 
        }
        hidden_effect = {
            event_target:charA = { duel_engine_clear_all_data = yes } # clearing event
            event_target:charB = { duel_engine_clear_all_data = yes } # clearing event
            clr_character_flag = duel
            #to add a reward to the duel sequence, edit the following scripted effect
            zz_duel_reward_sequence = yes
            #add xp gain event, and any special event checks. 
            #if = {
            #   limit = { has_character_flag = greenksin_bash_head_duel }
            #   remove_character_modifier = weak_warboss
            #	clr_character_flag = greenksin_bash_head_duel
            #	set_character_flag = weak_warboss_bashed_heads
            #}
        }
    }
}


