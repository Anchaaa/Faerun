#by Olrox17

targeted_decisions = {

	#intimidate ruler
	shadow_scare_ruler = {
		only_playable = yes

		ai_target_filter = realm
		ai_check_interval = 60

		from_potential = {
			has_dlc = "Conclave"
			is_playable = yes
			is_adult = yes
			NOT = { trait = incapable }
			society_rank = {
				society = shadow_thieves
				rank >= 2
			}
			prisoner = no
		}

		potential = {
			NOT = { character = FROM }
			age = 10
			is_ruler = yes
			OR = {
				FROM = { ai = yes } # Only checks realm, so by definition in range
				is_within_diplo_range = FROM
			}
		}

		allow = {
			ROOT = {
				NOT = { society_member_of = shadow_thieves }
				prisoner = no
				is_inaccessible_trigger = no
				NOT = { owes_favor_to = FROM }
			}
			OR = {
				FROM = { society_rank == 4 }
				ROOT = { same_realm = FROM }
			}
			FROM = {
				has_society_currency_medium_trigger = yes
				is_inaccessible_trigger = no
			}
			NOT = {
				has_opinion_modifier = {
					modifier = opinion_threatened_me
					who = FROM
				}
			}
		}

		effect = {
			FROM = { detract_society_currency_medium_effect = yes }
						FROM = { increase_visibility_effect = yes }

			random_list = {
				50 = {
					modifier = {
						factor = 9
						FROM = { society_rank == 4 }
					}
					modifier = {
						factor = 3
						FROM = { society_rank == 3 }
					}
					hidden_effect = { character_event = { id = MNM.6840 days = 1 } }
					FROM = { add_favor = ROOT }
				}
				50 = {
					modifier = { #Makes it even harder to threaten someone 2 steps above you
						factor = 3
						OR = {
							AND = {
								tier = EMPEROR
								FROM = { lower_tier_than = KING }
							}
							AND = {
								tier = KING
								FROM = { tier = BARON }
							}
						}
					}
					modifier = { #Makes it harder to threaten someone above you
						factor = 3
						higher_tier_than = FROM
					}
					custom_tooltip = { text = assassins_scare_ruler_fail }
					hidden_effect = { FROM = { character_event = { id = MNM.6980 days = 1 } } }
				}
			}

		}

		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1 # slow down
			}
			modifier = {
				FROM = { is_benevolent_trigger = yes }
				factor = 0.1
			}
			modifier = {
				FROM = { is_evil_trigger = yes }
				factor = 2
			}
			modifier = {
				OR = {
					is_friend = FROM
					is_lover = FROM
					NOR = {
						liege = { character = FROM }
						is_liege_of = FROM
					}
				}
				factor = 0
			}
		}
	}

	#sabotage
	shadow_sabotage = {
		only_playable = yes

		ai_target_filter = independent_rulers
		ai_check_interval = 48

		from_potential = {
			is_playable = yes
			is_adult = yes
			NOT = { trait = incapable }
			society_rank = {
				society = shadow_thieves
				rank >= 1
			}
			prisoner = no
		}

		potential = {
			NOT = { character = FROM }
			is_ruler = yes
			is_within_diplo_range = FROM
		}

		allow = {
			ROOT = {
				NOT = { society_member_of = shadow_thieves }
				prisoner = no
				is_inaccessible_trigger = no
			}
			FROM = {
				has_society_currency_minor_trigger = yes
				is_inaccessible_trigger = no
			}
			custom_tooltip = {
				text = shadow_sabotage_cooldown_tooltip
				NOT = { has_character_modifier = shadow_sabotage_cooldown }
			}
		}

		effect = {
			FROM = { detract_society_currency_minor_effect = yes }
			FROM = { increase_visibility_effect = yes }
			hidden_effect = {
				add_character_modifier = {
					name = shadow_sabotage_cooldown
					years = 4
					hidden = yes
				}
			}

			random_list = {
				33 = {
					ROOT = {
						random_demesne_province = {
							limit = {
								NOT = {
									has_province_modifier = smugglers_ring
								}
							}
							add_province_modifier = {
								name = smugglers_ring
								years = 4
							}
						}
					}
				}
				33 = {
					ROOT = {
						random_demesne_province = {
							limit = {
								NOT = {
									has_province_modifier = thieves_guild
								}
							}
							add_province_modifier = {
								name = thieves_guild
								years = 4
							}
						}
					}
				}
				33 = {
					ROOT = {
						random_demesne_province = {
							limit = {
								NOT = {
									has_province_modifier = highway_robber_band
								}
							}
							add_province_modifier = {
								name = highway_robber_band
								years = 4
							}
						}
					}
				}
			}

		}

		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1 # slow down
			}
			modifier = {
				is_foe = FROM
				factor = 100
			}
			modifier = {
				FROM = {
					opinion = {
						who = ROOT
						value <= -5
					}
					factor = 5
				}
			}
			modifier = {
				FROM = {
					opinion = {
						who = ROOT
						value <= -50
					}
					factor = 10
				}
			}
			modifier = {
				OR = {
					is_friend = FROM
					is_lover = FROM
				}
				factor = 0
			}
		}
	}

}

society_decisions = {

shadow_arts = {
	only_playable = yes

	filter = self
	ai_target_filter = self

	ai_check_interval = 60

	potential = {
		character = FROM
		is_playable = yes
		is_adult = yes
		society_member_of = shadow_thieves
		society_rank == 4
	}

	allow = {
		custom_tooltip = {
			text = choose_shadow_art_allow_tooltip

			NOT = { has_character_flag = choosing_shadow_art }
		}
		OR = {
			NOT = { lifestyle_traits = 1 }
			trait = schemer
			trait = impaler
			trait = seducer
			trait = seductress
		}
		has_society_currency_minor_trigger = yes
	}

	effect = {
		hidden_tooltip = {
			if = {
				limit = {
					NOT = { lifestyle_traits = 1 }
				}

				character_event = { id = STH.1900 }
			}
			if = {
				limit = {
					OR = {
						trait = schemer
						trait = impaler
						trait = seducer
						trait = seductress
					}
				}

				character_event = { id = STH.1901 }
			}
		}
		set_character_flag = choosing_shadow_art
		increase_visibility_effect = yes
		detract_society_currency_minor_effect = yes
	}

	revoke_allowed = { always = no }

	ai_will_do = {
		factor = 1
		modifier = {
			factor = 0
			lifestyle_traits = 1
		}
	}
}

}
