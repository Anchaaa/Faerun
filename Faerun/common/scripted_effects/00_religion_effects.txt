# add_sympathy_for_prevs_true_religion_effect
# add_sympathy_for_prevs_open_religion_effect
# flip_to_secret_religion_effect
# flip_secret_religious_community_provinces
# flip_all_realm_secret_religious_community_provinces
# root_secret_religion_provinces_convert_effect
# reset_religion_features_effect
# apply_cosmopolian_on_start_effect
# apply_dogmatic_on_start_effect
# reformation_god_names_changes_effect
# convert_religion_failsafe_effect
# abdicate_all_primary_type_titles_effect

# tsf4 note: some of these reform effects might not be needed, will keep commented out for now
add_sympathy_for_prevs_true_religion_effect = {
	if = {
		limit = {
			PREV = { true_religion_group_good_human_pantheon_group_trigger = yes }
			NOT = { religion_group = good_human_pantheon_group }
		}
		add_trait = sympathy_good_human_pantheon_group
	}
	else_if = {
		limit = {
			PREV = { true_religion_group_wild_human_pantheon_group_trigger = yes }
			NOT = { religion_group = wild_human_pantheon_group }
		}
		add_trait = sympathy_wild_human_pantheon_group
	}
	else_if = {
		limit = {
			PREV = { true_religion_group_humanoid_group_trigger = yes }
			NOT = { religion_group = humanoid_group }
		}
		add_trait = sympathy_humanoid_group
	}
	else_if = {
		limit = {
			PREV = { true_religion_group_evil_human_pantheon_group_trigger = yes }
			NOT = { religion_group = evil_human_pantheon_group }
		}
		add_trait = sympathy_evil_human_pantheon_group
	}
	else_if = {
		limit = {
			PREV = { true_religion_group_qismaite_group_trigger = yes }
			NOT = { religion_group = qismaite_group }
		}
		add_trait = sympathy_qismaite_group
	}
	else_if = {
		limit = {
			PREV = { true_religion_group_karaturan_group_trigger = yes }
			NOT = { religion_group = karaturan_group }
		}
		add_trait = sympathy_karaturan_group
	}
	else_if = {
		limit = {
			PREV = { true_religion_group_elven_pantheon_group_trigger = yes }
			NOT = { religion_group = elven_pantheon_group }
		}
		add_trait = sympathy_elven_pantheon_group
	}
	else_if = {
		limit = {
			PREV = { true_religion_group_drow_pantheon_trigger = yes }
			NOT = { religion_group = drow_pantheon }
		}
		add_trait = sympathy_drow_pantheon
	}
	else_if = {
		limit = {
			PREV = { true_religion_group_dwarven_pantheon_group_trigger = yes }
			NOT = { religion_group = dwarven_pantheon_group }
		}
		add_trait = sympathy_dwarven_pantheon_group
	}
	else_if = {
		limit = {
			PREV = { true_religion_group_giant_pantheon_group_trigger = yes }
			NOT = { religion_group = giant_pantheon_group }
		}
		add_trait = sympathy_giant_pantheon_group
	}
	else_if = {
		limit = {
			PREV = { true_religion_group_draconic_group_trigger = yes }
			NOT = { religion_group = draconic_group }
		}
		add_trait = sympathy_draconic_group
	}
	else_if = {
		limit = {
			PREV = { true_religion_group_unenlightened_group_trigger = yes }
			NOT = { religion_group = unenlightened_group }
		}
		add_trait = sympathy_unenlightened_group
	}
	else_if = {
		limit = {
			PREV = { true_religion_group_atheist_group_trigger = yes }
			NOT = { religion_group = atheist_group }
		}
		add_trait = sympathy_atheist_group
	}
}

add_sympathy_for_prevs_open_religion_effect = {
	if = {
		limit = {
			PREV = { religion_group = good_human_pantheon_group }
			NOT = { religion_group = good_human_pantheon_group }
		}
		add_trait = sympathy_good_human_pantheon_group
	}
	else_if = {
		limit = {
			PREV = { religion_group = wild_human_pantheon_group }
			NOT = { religion_group = wild_human_pantheon_group }
		}
		add_trait = sympathy_wild_human_pantheon_group
	}
	else_if = {
		limit = {
			PREV = { religion_group = humanoid_group }
			NOT = { religion_group = humanoid_group }
		}
		add_trait = sympathy_humanoid_group
	}
	else_if = {
		limit = {
			PREV = { religion_group = evil_human_pantheon_group }
			NOT = { religion_group = evil_human_pantheon_group }
		}
		add_trait = sympathy_evil_human_pantheon_group
	}
	else_if = {
		limit = {
			PREV = { religion_group = qismaite_group }
			NOT = { religion_group = qismaite_group }
		}
		add_trait = sympathy_qismaite_group
	}
	else_if = {
		limit = {
			PREV = { religion_group = karaturan_group }
			NOT = { religion_group = karaturan_group }
		}
		add_trait = sympathy_karaturan_group
	}
	else_if = {
		limit = {
			PREV = { religion_group = elven_pantheon_group }
			NOT = { religion_group = elven_pantheon_group }
		}
		add_trait = sympathy_elven_pantheon_group
	}
	else_if = {
		limit = {
			PREV = { religion_group = drow_pantheon }
			NOT = { religion_group = drow_pantheon }
		}
		add_trait = sympathy_drow_pantheon
	}
	else_if = {
		limit = {
			PREV = { religion_group = dwarven_pantheon_group }
			NOT = { religion_group = dwarven_pantheon_group }
		}
		add_trait = sympathy_dwarven_pantheon_group
	}
	else_if = {
		limit = {
			PREV = { religion_group = giant_pantheon_group }
			NOT = { religion_group = giant_pantheon_group }
		}
		add_trait = sympathy_giant_pantheon_group
	}
	else_if = {
		limit = {
			PREV = { religion_group = draconic_group }
			NOT = { religion_group = draconic_group }
		}
		add_trait = sympathy_draconic_group
	}
	else_if = {
		limit = {
			PREV = { religion_group = unenlightened_group }
			NOT = { religion_group = unenlightened_group }
		}
		add_trait = sympathy_unenlightened_group
	}
	else_if = {
		limit = {
			PREV = { religion_group = atheist_group }
			NOT = { religion_group = atheist_group }
		}
		add_trait = sympathy_atheist_group
	}
}

# Referenced by Alternate Start religion feature generation
reset_religion_features_effect = {
	set_peace_piety_gain = 0
	set_pacifist = no
	set_convert_other_groups = 2
	set_convert_same_group = 2
	set_peace_prestige_loss = no
	set_ai_aggression = 1
	set_unit_modifier = {}
	set_unit_home_modifier = {}
	set_hard_to_convert = no
	set_raised_vassal_opinion_loss = yes
	set_piety_loss_for_attacking_same_religion = no
	set_max_wives = 1
	set_max_consorts = 0
	set_feminist = no
	set_heir_designation = no
	set_short_reign_opinion_year_mult = -1000
	set_jizya_tax = no
	set_can_retire_to_monastery = no
	set_can_excommunicate = no
	set_can_grant_divorce = no
	set_can_grant_invasion_cb = no
	set_can_grant_claim = no
	set_can_call_crusade = no
	set_pc_marriage = no
	set_bs_marriage = no
	set_psc_marriage = yes
	set_cousin_marriage = yes
	set_seafaring = no
	set_allow_looting = no
	set_allow_rivermovement = no
	set_autocephaly = no
	set_pentarchy = no
	set_divine_blood = no
	set_uses_decadence = no
	set_can_have_antipopes = no
	set_priests_can_marry = no
	set_priests_can_inherit = yes
	set_ignores_defensive_attrition = no
	set_defensive_attrition = no
	clear_intermarry = no
	set_character_modifier = {}
	clear_intermarry = yes
	set_allows_matrilineal_marriage = yes
}

apply_cosmopolian_on_start_effect = {
	religion_authority = {
		name = cosmopolitan_religion
		years = 1000
	}

	any_playable_ruler = {
		limit = {
			distance_from_realm = {
				who = ROOT
				value < 200
			}
		}

		add_intermarry = ROOT
		ROOT = { add_intermarry = PREV }
	}

	any_neighbor_independent_ruler = {
		add_intermarry = ROOT
		ROOT = { add_intermarry = PREV }
	}
}

apply_dogmatic_on_start_effect = {
	religion_authority = {
		name = dogmatic_religion
		years = 1000
	}

	remove_intermarry = humanoid_group
	remove_intermarry = good_human_pantheon_group
	remove_intermarry = evil_human_pantheon_group
	remove_intermarry = qismaite_group
	remove_intermarry = karaturan_group
	remove_intermarry = elven_pantheon_group
	remove_intermarry = drow_pantheon
	remove_intermarry = dwarven_pantheon_group
	remove_intermarry = giant_pantheon_group
	remove_intermarry = monster_group
	remove_intermarry = draconic_group
	remove_intermarry = atheist_group
	remove_intermarry = aberration_group
}

# Fires on_startup
setup_reformed_religion_scope = {
	if = {
		limit = {
			is_multiplayer_host_character = yes
		}

		uthgardt_reformed = {
			save_persistent_event_target = {
				name = religion_title
				scope = d_uthgardt_reformed
			}
			persistent_event_target:religion_title = {
				save_persistent_event_target = {
					name = religion_scope
					scope = PREV
				}
			}
		}
		earthmother_reformed = {
			save_persistent_event_target = {
				name = religion_title
				scope = d_earthmother_reformed
			}
			persistent_event_target:religion_title = {
				save_persistent_event_target = {
					name = religion_scope
					scope = PREV
				}
			}
		}
		qotal_reformed = {
			save_persistent_event_target = {
				name = religion_title
				scope = d_qotal_reformed
			}
			persistent_event_target:religion_title = {
				save_persistent_event_target = {
					name = religion_scope
					scope = PREV
				}
			}
		}
		nogari_reformed = {
			save_persistent_event_target = {
				name = religion_title
				scope = d_nogari_reformed
			}
			persistent_event_target:religion_title = {
				save_persistent_event_target = {
					name = religion_scope
					scope = PREV
				}
			}
		}
		jaziri_reformed = {
			save_persistent_event_target = {
				name = religion_title
				scope = d_jaziri_reformed
			}
			persistent_event_target:religion_title = {
				save_persistent_event_target = {
					name = religion_scope
					scope = PREV
				}
			}
		}
		yuir_reformed = {
			save_persistent_event_target = {
				name = religion_title
				scope = d_yuir_reformed
			}
			persistent_event_target:religion_title = {
				save_persistent_event_target = {
					name = religion_scope
					scope = PREV
				}
			}
		}
		ulutiuan_reformed = {
			save_persistent_event_target = {
				name = religion_title
				scope = d_ulutiuan_reformed
			}
			persistent_event_target:religion_title = {
				save_persistent_event_target = {
					name = religion_scope
					scope = PREV
				}
			}
		}
		goblin_reformed = {
			save_persistent_event_target = {
				name = religion_title
				scope = d_goblin_reformed
			}
			persistent_event_target:religion_title = {
				save_persistent_event_target = {
					name = religion_scope
					scope = PREV
				}
			}
		}
		orc_reformed = {
			save_persistent_event_target = {
				name = religion_title
				scope = d_orc_reformed
			}
			persistent_event_target:religion_title = {
				save_persistent_event_target = {
					name = religion_scope
					scope = PREV
				}
			}
		}
		
		# scan all reformed religion
		if = {
			limit = {
				is_save_game = yes
				has_religion_features = yes
				
				# Do not support Random Start
				NOT = {
					has_alternate_start_parameter = {
						key = religion_names
						value = random
					}
				}
			}

			uthgardt_faith = {
				if = {
					limit = {
						parent_religion = {
							always = yes
						}
					}
				}
				parent_religion = {
					rebuild_god_name_effect = yes
				}
			}
			earthmother = {
				if = {
					limit = {
						parent_religion = {
							always = yes
						}
					}
				}
				parent_religion = {
					rebuild_god_name_effect = yes
				}
			}
			qotal = {
				if = {
					limit = {
						parent_religion = {
							always = yes
						}
					}
				}
				parent_religion = {
					rebuild_god_name_effect = yes
				}
			}
			nogari = {
				if = {
					limit = {
						parent_religion = {
							always = yes
						}
					}
				}
				parent_religion = {
					rebuild_god_name_effect = yes
				}
			}
			jaziri = {
				if = {
					limit = {
						parent_religion = {
							always = yes
						}
					}
				}
				parent_religion = {
					rebuild_god_name_effect = yes
				}
			}
			yuir = {
				if = {
					limit = {
						parent_religion = {
							always = yes
						}
					}
				}
				parent_religion = {
					rebuild_god_name_effect = yes
				}
			}
			ulutiuan = {
				if = {
					limit = {
						parent_religion = {
							always = yes
						}
					}
				}
				parent_religion = {
					rebuild_god_name_effect = yes
				}
			}
			goblin_pantheon = {
				if = {
					limit = {
						parent_religion = {
							always = yes
						}
					}
				}
				parent_religion = {
					rebuild_god_name_effect = yes
				}
			}
			orc_pantheon = {
				if = {
					limit = {
						parent_religion = {
							always = yes
						}
					}
				}
				parent_religion = {
					rebuild_god_name_effect = yes
				}
			}
		}
	}
}

export_reformer_to_title_effect = {
	# THIS is the religion title
	# PREV is the religion_scope
	if = {
		limit = {
			has_dlc = "Holy Fury"

			NOT = {
				has_alternate_start_parameter = {
					key = religion_names
					value = random
				}
			}
		}

		save_event_target_as = religion_title_for_setup

		save_persistent_event_target = {
			name = god_self
			scope = ROOT
		}

		ROOT = {
			if = { # Spouse
				limit = {
					any_spouse = {
						trigger_if = {
							limit = { is_female = no }

							ROOT = {
								NOT = { has_religion_feature = religion_matriarchal }
							}
						}
						trigger_else = {
							ROOT = {
								NOT = { has_religion_feature = religion_patriarchal }
							}
						}
					}
				}

				random_spouse = {
					limit = {
						trigger_if = {
							limit = { is_female = no }

							ROOT = {
								NOT = { has_religion_feature = religion_matriarchal }
							}
						}
						trigger_else = {
							ROOT = {
								NOT = { has_religion_feature = religion_patriarchal }
							}
						}
					}

					event_target:religion_title_for_setup = {
						save_persistent_event_target = {
							name = god_spouse
							scope = PREV
						}
					}
				}
			}

			if = { # Child
				limit = {
					any_child = {
						trigger_if = {
							limit = { is_female = no }

							ROOT = {
								NOT = { has_religion_feature = religion_matriarchal }
							}
						}
						trigger_else = {
							ROOT = {
								NOT = { has_religion_feature = religion_patriarchal }
							}
						}
					}
				}

				random_child = {
					limit = {
						trigger_if = {
							limit = { is_female = no }

							ROOT = {
								NOT = { has_religion_feature = religion_matriarchal }
							}
						}
						trigger_else = {
							ROOT = {
								NOT = { has_religion_feature = religion_patriarchal }
							}
						}
					}

					preferred_limit = {
						is_primary_heir = ROOT
					}

					event_target:religion_title_for_setup = {
						save_persistent_event_target = {
							name = god_child
							scope = PREV
						}
					}
				}
			}

			if = { # Sibling
				limit = {
					any_sibling = {
						trigger_if = {
							limit = { is_female = no }

							ROOT = {
								NOT = { has_religion_feature = religion_matriarchal }
							}
						}
						trigger_else = {
							ROOT = {
								NOT = { has_religion_feature = religion_patriarchal }
							}
						}
					}
				}

				random_sibling = {
					limit = {
						trigger_if = {
							limit = { is_female = no }

							ROOT = {
								NOT = { has_religion_feature = religion_matriarchal }
							}
						}
						trigger_else = {
							ROOT = {
								NOT = { has_religion_feature = religion_patriarchal }
							}
						}
					}

					preferred_limit = {
						is_primary_heir = ROOT
					}

					event_target:religion_title_for_setup = {
						save_persistent_event_target = {
							name = god_sibling
							scope = PREV
						}
					}
				}
			}
		}
	}
}

rebuild_god_name_effect = {
	# THIS is the religion_scope
	if = {
		limit = {
			OR = {
				has_religion_feature = religion_holy_family
				has_religion_feature = religion_feature_nogari
			}

			NOT = {
				has_alternate_start_parameter = {
					key = religion_names
					value = random
				}
			}
		}

		save_event_target_as = religion_target

		# Formatting god namespace
		remove_god_names = yes
		remove_evil_god_names = yes

		if = {
			limit = { # Holy Family actually becomes Holy
				OR = {
					has_religion_feature = religion_holy_family
					has_religion_feature = religion_feature_nogari
				}
			}

			# Runs in religion title scope, for persistent_event_target stored inside
			persistent_event_target:religion_title = {
				if = {
					limit = { # Reformer himself, but only if he is not becoming the High God due to synergy
						NOT = { has_religion_feature = religion_temporal_head }
						
						trigger_if = {
							limit = {
								persistent_event_target:god_self = { is_female = no }
							}
							
							NOT = { has_religion_feature = religion_matriarchal }
						}
						trigger_else = {
							NOT = { has_religion_feature = religion_patriarchal }
						}
					}
					
					persistent_event_target:god_self = {
						event_target:religion_target = { add_god_name = PREV_FNAME }
					}
				}
				
				if = {
					limit = { # Father
						persistent_event_target:god_dad = {
							always = yes
						}
					}
					
					if = {
						limit = {
							NOT = { has_religion_feature = religion_matriarchal }
						}
						
						persistent_event_target:god_dad = {
							event_target:religion_target = { add_god_name = PREV_FNAME }
						}
					}
					else = {
						persistent_event_target:god_dad = {
							event_target:religion_target = { add_evil_god_name = PREV_FNAME }
						}
					}
				}
				
				if = {
					limit = { # Mother
						persistent_event_target:god_mom = {
							always = yes
						}
					}
					
					if = {
						limit = {
							NOT = { has_religion_feature = religion_patriarchal }
						}
						
						persistent_event_target:god_mom = {
							event_target:religion_target = { add_god_name = PREV_FNAME }
						}
					}
					else = {
						persistent_event_target:god_mom = {
							event_target:religion_target = { add_evil_god_name = PREV_FNAME }
						}
					}
				}
				
				if = {
					limit = { # Spouse
						persistent_event_target:god_spouse = {
							always = yes
						}
					}
					
					persistent_event_target:god_spouse = {
						event_target:religion_target = { add_god_name = PREV_FNAME }
					}
				}
				
				if = {
					limit = { # Child
						persistent_event_target:god_child = {
							always = yes
						}
					}
					
					persistent_event_target:god_child = {
						event_target:religion_target = { add_god_name = PREV_FNAME }
					}
				}
				
				if = {
					limit = { # Sibling
						persistent_event_target:god_sibling = {
							always = yes
						}
					}
					
					persistent_event_target:god_sibling = {
						event_target:religion_target = { add_god_name = PREV_FNAME }
					}
				}
			}
		}

		# Religion is not sexist
		if = {
			limit = {
				religion = uthgardt_reformed
			}

			add_god_name = GOD_UTHGAR
			add_god_name = GOD_BLACK_LION
			add_god_name = GOD_BLACK_RAVEN
			add_god_name = GOD_BLUE_BEAR
			add_god_name = GOD_ELK
			add_god_name = GOD_GRAY_WOLF
			add_god_name = GOD_GREAT_WORM
			add_god_name = GOD_GRIFFON
			add_god_name = GOD_RED_TIGER
			add_god_name = GOD_SKY_PONY
			add_god_name = GOD_THUNDERBEAST
			add_god_name = GOD_TREE_GHOST
			add_god_name = GOD_RED_PONY
			add_god_name = GOD_GOLDEN_EAGLE
			add_evil_god_name = GOD_HELM
			add_evil_god_name = GOD_ILMATER
			add_evil_god_name = GOD_TYR
			add_evil_god_name = GOD_TORM
			add_evil_god_name = GOD_MALAR
			add_evil_god_name = GOD_AURIL
		}
		else_if = {
			limit = {
				religion = earthmother_reformed
			}

			add_god_name = GOD_EARTHMOTHER
			add_god_name = GOD_LEVIATHAN
			add_god_name = GOD_UNICORN
			add_god_name = GOD_PACK
			add_god_name = GOD_GROND_PEAKSMASHER
			add_evil_god_name = GOD_UMBERLEE
			add_evil_god_name = GOD_MALAR
			add_evil_god_name = GOD_TALOS
			add_evil_god_name = GOD_AURIL
		}
		else_if = {
			limit = {
				religion = qotal_reformed
			}

			add_god_name = GOD_QOTAL
			add_god_name = GOD_MAZTICA
			add_god_name = GOD_KUKUL
			add_god_name = GOD_KILTZI
			add_god_name = GOD_KUKUL
			add_god_name = GOD_NULA
			add_god_name = GOD_EHA
			add_evil_god_name = GOD_ZALTEC
			add_evil_god_name = GOD_TEZCA
			add_evil_god_name = GOD_AZUL
			add_evil_god_name = GOD_PLUTOQ
		}
		else_if = {
			limit = {
				religion = nogari_reformed
			}

			add_god_name = GOD_SHAJAR
			add_god_name = GOD_RAGARRA
			add_god_name = GOD_KIGA
			add_god_name = GOD_LOST_ONE
			add_god_name = GOD_MIGAL
			add_god_name = GOD_LOLTH
			add_evil_god_name = GOD_EADRO
		}
		else_if = {
			limit = {
				religion = jaziri_reformed
			}

			add_god_name = GOD_LOST_ONE
			add_god_name = GOD_THE_DRUMMER
			add_god_name = GOD_KARRRGA
			add_god_name = GOD_PAG
			add_god_name = GOD_THE_BEAST
			add_evil_god_name = GOD_THASMUDYAN
		}
		else_if = {
			limit = {
				religion = yuir_reformed
			}

			add_god_name = GOD_SIMBUL
			add_god_name = GOD_ELIKARASHAE
			add_god_name = GOD_MAGNAR
			add_god_name = GOD_RELKATH
			add_god_name = GOD_ZANDILAR
			add_evil_god_name = GOD_DARKNESS
		}
		else_if = {
			limit = {
				religion = ulutiuan_reformed
			}

			add_god_name = GOD_ULUTIU
			add_evil_god_name = GOD_ANNAM
			add_evil_god_name = GOD_UMBERLEE
			add_evil_god_name = GOD_AURIL
		}
		else_if = {
			limit = {
				religion = orc_reformed
			}

			add_god_name = GOD_GRUUMSH
			add_god_name = GOD_LUTHIC
			add_god_name = GOD_ILNEVAL
			add_god_name = GOD_BAHGTRU
			add_god_name = GOD_SHARGAAS
			add_god_name = GOD_YURTRUS
			add_god_name = GOD_OBOULD
			add_evil_god_name = GOD_CORELLON_LARETHIAN
			add_evil_god_name = GOD_MORADIN
			add_evil_god_name = GOD_MAGLUBIYET
			add_evil_god_name = GOD_LOLTH
			add_evil_god_name = GOD_YONDALLA
		}
		else_if = {
			limit = {
				religion = goblin_reformed
			}

			add_god_name = GOD_MAGLUBIYET
			add_god_name = god_khurgorbaeyag
			add_god_name = god_nomog_geaya
			add_god_name = god_bargrivyek
			add_god_name = god_hruggek
			add_god_name = god_grankhul
			add_god_name = GOD_SKIGGARET
			add_evil_god_name = GOD_MORADIN
			add_evil_god_name = GOD_YONDALLA
			add_evil_god_name = GOD_GARL_GLITTERGOLD
			add_evil_god_name = GOD_GRUUMSH
		}
	}
}

# convert_religion_failsafe_effect = {
	# hidden_effect = {
		# if = {
			# limit = {
				# is_theocracy = yes
				# is_ruler = yes
			# }

			# set_character_flag = needs_temporary_fake_theocracy_government
			# set_government_type = temporary_fake_theocracy_government
		# }
	# }

	# trigger_switch = {
		# on_trigger = has_character_flag

		# convert_secret = {
			# convert_to_secret_religion = yes
			# clr_character_flag = convert_secret
		# }

		# convert_heretic = {
			# become_heretic = yes
			# clr_character_flag = convert_heretic
		# }

		# convert_abandon_heresy = {
			# abandon_heresy = yes
			# clr_character_flag = convert_abandon_heresy
		# }

		# fallback = {
			# religion = event_target:target_religion
			# clear_event_target = target_religion
		# }
	# }

	# hidden_effect = {
		# if = {
			# limit = { government = temporary_fake_theocracy_government }

			# # Stop apostates from becoming the pope
			# if = {
				# limit = {
					# NOT = { religion = catholic }
				# }

				# remove_title = title_cardinal
			# }

			# if = {
				# limit = {
					# NOT = { religion = fraticelli }
				# }

				# remove_title = title_fraticelli_cardinal
			# }

			# # Check if my new religion even has theocracies
			# if = {
				# limit = {
					# NOR = {
						# is_government_potential = muslim_government
						# is_government_potential = theocratic_feudal_government
					# }
				# }

				# # Check if my new religion allows me to remain a priest
				# if = {
					# limit = {
						# trigger_if = {
							# limit = { is_female = no }
							# religion_allows_male_temple_holders = yes
						# }
						# trigger_else = {
							# religion_allows_female_temple_holders = yes
						# }
					# }

					# # Check if my new religion allows me to remain married
					# if = {
						# limit = {
							# # TODO: Replace with flag on religions
							# OR = {
								# religion_group = christian
								# religion_group = zoroastrian_group
								# religion_openly_bon_or_reformed_trigger = yes
								# religion = jain
								# religion = buddhist
								# religion = taoist
							# }
						# }

						# any_spouse = { remove_spouse = PREV }
						# any_consort = { remove_consort = PREV }
					# }

					# set_correct_theocratic_government_type_effect = yes
				# }
				# else = {
					# # Abdicate
					# random_courtier = {
						# limit = {
							# religion = PREV
							# is_opposite_sex = PREV
							# is_ruler = no

							# trigger_if = {
								# limit = { has_dharmic_religion_trigger = yes }
								# trait = brahmin
							# }

							# trigger_if = {
								# limit = {
									# OR = {
										# religion_group = christian
										# religion_group = zoroastrian_group
										# religion_openly_bon_or_reformed_trigger = yes
										# religion = jain
										# religion = buddhist
										# religion = taoist
									# }
								# }

								# is_married = no
								# is_consort = no
								# is_senior_consort_party = no
							# }

							# NOR = {
								# any_heir_title = { always = yes }
								# any_pretender_title = { always = yes }
							# }
						# }

						# save_event_target_as = new_priest
					# }

					# if = {
						# limit = {
							# NOT = { event_target:new_priest = { always = yes } }
						# }

						# if = {
							# limit = { religion_allows_female_temple_holders = yes }

							# create_random_priest = {
								# random_traits = yes
								# religion = THIS
								# culture = THIS
								# female = yes
							# }
						# }
						# else = {
							# create_random_priest = {
								# random_traits = yes
								# religion = THIS
								# culture = THIS
								# female = no
							# }
						# }

						# new_character = {
							# save_event_target_as = new_priest

							# if = {
								# limit = { has_dharmic_religion_trigger = yes }
								# add_trait = brahmin
								# character_event = { id = RoI.30120 } # Pick random sect
							# }
						# }
					# }

					# # Abdication effects leave undesirable claims
					# any_demesne_title = {
						# gain_title = event_target:new_priest
					# }

					# transfer_scaled_wealth = {
						# to = event_target:new_priest
						# value = all
					# }

					# # TODO: Transfer artifacts?

					# clear_event_target = new_priest
				# }
			# }
			# else = {
				# set_correct_feudal_government_type_effect = yes
			# }

			# # Clear this flag, so that characters are forced into a normal government
			# # Characters who have abdicated may take a day to find their way back into a court and get a suitable government
			# clr_character_flag = needs_temporary_fake_theocracy_government
		# }
	# }
# }

abdicate_all_primary_type_titles_effect = {
	if = {
		limit = { controls_religion = yes }

		# Secular religious head titles are forfeit
		if = {
			limit = { is_theocracy = no }

			any_demesne_title = {
				limit = { controls_religion = yes }
				destroy_landed_title = THIS
			}
		}

		# Theocratic religious head titles are given to a random new character
		else = {
			hidden_effect = {
				liege = {
					save_event_target_as = liege_target
				}
			}

			any_demesne_title = {
				show_scope_change = no

				limit = { controls_religion = yes }

				hidden_effect = {
					create_character = {
						age = 38
						dynasty = random
						religion = ROOT
						culture = ROOT
						random_traits = yes
					}
				}

				grant_title = new_character

				holder_scope = {
					show_scope_change = no

					any_vassal = {
						show_scope_change = no

						set_defacto_liege = event_target:liege_target
					}
				}
			}

			hidden_effect = {
				set_defacto_liege = event_target:liege_target
			}
		}
	}

	if = { # Holy Orders/Static Mercs are given to a random new character
		limit = {
			OR = {
				holy_order = yes
				mercenary = yes
			}
		}

		hidden_effect = {
			liege = {
				save_event_target_as = liege_target
			}
		}

		any_demesne_title = {
			show_scope_change = no

			limit = {
				OR = {
					holy_order = yes
					mercenary = yes
				}
			}

			hidden_effect = {
				create_character = {
					age = 38
					dynasty = random
					religion = PREV
					culture = PREV
					random_traits = yes
				}
			}

			grant_title = new_character

			holder_scope = {
				show_scope_change = no

				any_vassal = {
					show_scope_change = no

					set_defacto_liege = event_target:liege_target
				}
			}
		}

		hidden_effect = {
			set_defacto_liege = event_target:liege_target
		}
	}
}