uthgar_defeat_heresy = {
	name = CB_NAME_UTHGAR_HERESY
	war_name = WAR_NAME_UTHGAR_HERESY
	sprite = 35
	truce_days = 3650
	hostile_against_others = yes
    is_permanent = yes
    check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
    can_ask_to_join_war = no
    allowed_to_target_tributaries = yes
    infamy_modifier = 2
    sort_priority = 691
	apply_short_occ_mod = no # Do not apply the 'recently_conquered' modifier to Holdings

	can_use = {
		ROOT = {
			uthgardt_faith_trigger = yes
			OR = {
				independent = yes
				higher_tier_than = COUNT
			}
			NOT = {
				any_liege = {
					character = FROM
				}
			}
			mercenary = no
			NOT = {
				FROM = {
					any_liege = {
						character = ROOT
					}
				}
			}
		}
		FROM = {
			NOT = { uthgardt_faith_trigger = yes }
			OR = {
				has_landed_title = d_black_lion
				has_landed_title = d_black_raven
				has_landed_title = d_blue_bear
				has_landed_title = d_elk
				has_landed_title = d_gray_wolf
				has_landed_title = d_great_worm
				has_landed_title = d_griffon
				has_landed_title = d_red_tiger
				has_landed_title = d_sky_pony
				has_landed_title = d_thunderbeast
				has_landed_title = d_tree_ghost
			}
		}
	}

	can_use_title = {
		OR = {
			title = d_black_lion
			title = d_black_raven
			title = d_blue_bear
			title = d_elk
			title = d_gray_wolf
			title = d_great_worm
			title = d_griffon
			title = d_red_tiger
			title = d_sky_pony
			title = d_thunderbeast
			title = d_tree_ghost
		}
		FROM = {
			has_landed_title = PREV
		}
	}

	is_valid = {
		ROOT = {
			uthgardt_faith_trigger = yes
		}
		FROM = {
			NOT = { uthgardt_faith_trigger = yes }
		}
	}

	is_valid_title = {
		FROM = {
			has_landed_title = PREV
		}
	}

	on_add = {
		if = {
			limit = { defender = { is_offmap_governor = shou_lung } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		if = {
			limit = {
				ROOT = {
					trait = patron_hoar
					is_rival = FROM
				}
			}
			ROOT = { piety = 40 }
		}
		any_attacker = {
			participation_scaled_piety = 100
			participation_scaled_prestige = 50
		}
		FROM = { show_scope_change = no piety = -100 }
		FROM = { show_scope_change = no prestige = -50 }
	}

	on_success_title = {
		custom_tooltip = {
			text = UTHHERESYWIN
			hidden_tooltip = {
				if = {
					limit = {
						d_black_lion = {
							title = PREV
						}
					}
					if = {
						limit = {
							ROOT = {
								trait = uthgar_black_lion
							}
						}
						ROOT = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
						}
					}
					else_if = {
						limit = {
							ROOT = {
								NOT = { trait = uthgar_black_lion }
							}
						}
						create_character = {
							age = 25
							trait = creature_human
							trait = uthgar_black_lion
							female = random
							religion = uthgardt_faith
							culture = uthgardt
							dynasty = actually_culture
							random_traits = yes
						}
						new_character = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
							usurp_title = {
								target = PREV
								type = holy_war
							}
							if = {
								limit = {
									ROOT = {
										higher_tier_than = DUKE
									}
								}
								set_defacto_liege = ROOT
							}
							else_if = {
								limit = {
									ROOT = {
										NOT = { higher_tier_than = DUKE }
									}
								}
								add_alliance = {
									who = ROOT
									years = 999
								}
							}
						}
					}
				}
				else_if = {
					limit = {
						d_black_raven = {
							title = PREV
						}
					}
					if = {
						limit = {
							ROOT = {
								trait = uthgar_black_raven
							}
						}
						ROOT = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
						}
					}
					else_if = {
						limit = {
							ROOT = {
								NOT = { trait = uthgar_black_lion }
							}
						}
						create_character = {
							age = 25
							trait = creature_human
							trait = uthgar_black_raven
							female = random
							religion = uthgardt_faith
							culture = uthgardt
							dynasty = actually_culture
							random_traits = yes
						}
						new_character = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
							usurp_title = {
								target = PREV
								type = holy_war
							}
							if = {
								limit = {
									ROOT = {
										higher_tier_than = DUKE
									}
								}
								set_defacto_liege = ROOT
							}
							else_if = {
								limit = {
									ROOT = {
										NOT = { higher_tier_than = DUKE }
									}
								}
								add_alliance = {
									who = ROOT
									years = 999
								}
							}
						}
					}
				}
				else_if = {
					limit = {
						d_blue_bear = {
							title = PREV
						}
					}
					if = {
						limit = {
							ROOT = {
								trait = uthgar_blue_bear
							}
						}
						ROOT = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
						}
					}
					else_if = {
						limit = {
							ROOT = {
								NOT = { trait = uthgar_blue_bear }
							}
						}
						create_character = {
							age = 25
							trait = creature_human
							trait = uthgar_blue_bear
							female = random
							religion = uthgardt_faith
							culture = uthgardt
							dynasty = actually_culture
							random_traits = yes
						}
						new_character = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
							usurp_title = {
								target = PREV
								type = holy_war
							}
							if = {
								limit = {
									ROOT = {
										higher_tier_than = DUKE
									}
								}
								set_defacto_liege = ROOT
							}
							else_if = {
								limit = {
									ROOT = {
										NOT = { higher_tier_than = DUKE }
									}
								}
								add_alliance = {
									who = ROOT
									years = 999
								}
							}
						}
					}
				}
				else_if = {
					limit = {
						d_elk = {
							title = PREV
						}
					}
					if = {
						limit = {
							ROOT = {
								trait = uthgar_elk
							}
						}
						ROOT = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
						}
					}
					else_if = {
						limit = {
							ROOT = {
								NOT = { trait = uthgar_elk }
							}
						}
						create_character = {
							age = 25
							trait = creature_human
							trait = uthgar_elk
							female = random
							religion = uthgardt_faith
							culture = uthgardt
							dynasty = actually_culture
							random_traits = yes
						}
						new_character = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
							usurp_title = {
								target = PREV
								type = holy_war
							}
							if = {
								limit = {
									ROOT = {
										higher_tier_than = DUKE
									}
								}
								set_defacto_liege = ROOT
							}
							else_if = {
								limit = {
									ROOT = {
										NOT = { higher_tier_than = DUKE }
									}
								}
								add_alliance = {
									who = ROOT
									years = 999
								}
							}
						}
					}
				}
				else_if = {
					limit = {
						d_gray_wolf = {
							title = PREV
						}
					}
					if = {
						limit = {
							ROOT = {
								trait = uthgar_gray_wolf
							}
						}
						ROOT = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
						}
					}
					else_if = {
						limit = {
							ROOT = {
								NOT = { trait = uthgar_gray_wolf }
							}
						}
						create_character = {
							age = 25
							trait = creature_human
							trait = uthgar_gray_wolf
							female = random
							religion = uthgardt_faith
							culture = uthgardt
							dynasty = actually_culture
							random_traits = yes
						}
						new_character = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
							usurp_title = {
								target = PREV
								type = holy_war
							}
							if = {
								limit = {
									ROOT = {
										higher_tier_than = DUKE
									}
								}
								set_defacto_liege = ROOT
							}
							else_if = {
								limit = {
									ROOT = {
										NOT = { higher_tier_than = DUKE }
									}
								}
								add_alliance = {
									who = ROOT
									years = 999
								}
							}
						}
					}
				}
				else_if = {
					limit = {
						d_great_worm = {
							title = PREV
						}
					}
					if = {
						limit = {
							ROOT = {
								trait = uthgar_great_worm
							}
						}
						ROOT = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
						}
					}
					else_if = {
						limit = {
							ROOT = {
								NOT = { trait = uthgar_great_worm }
							}
						}
						create_character = {
							age = 25
							trait = creature_human
							trait = uthgar_great_worm
							female = random
							religion = uthgardt_faith
							culture = uthgardt
							dynasty = actually_culture
							random_traits = yes
						}
						new_character = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
							usurp_title = {
								target = PREV
								type = holy_war
							}
							if = {
								limit = {
									ROOT = {
										higher_tier_than = DUKE
									}
								}
								set_defacto_liege = ROOT
							}
							else_if = {
								limit = {
									ROOT = {
										NOT = { higher_tier_than = DUKE }
									}
								}
								add_alliance = {
									who = ROOT
									years = 999
								}
							}
						}
					}
				}
				else_if = {
					limit = {
						d_griffon = {
							title = PREV
						}
					}
					if = {
						limit = {
							ROOT = {
								trait = uthgar_griffon
							}
						}
						ROOT = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
						}
					}
					else_if = {
						limit = {
							ROOT = {
								NOT = { trait = uthgar_griffon }
							}
						}
						create_character = {
							age = 25
							trait = creature_human
							trait = uthgar_griffon
							female = random
							religion = uthgardt_faith
							culture = uthgardt
							dynasty = actually_culture
							random_traits = yes
						}
						new_character = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
							usurp_title = {
								target = PREV
								type = holy_war
							}
							if = {
								limit = {
									ROOT = {
										higher_tier_than = DUKE
									}
								}
								set_defacto_liege = ROOT
							}
							else_if = {
								limit = {
									ROOT = {
										NOT = { higher_tier_than = DUKE }
									}
								}
								add_alliance = {
									who = ROOT
									years = 999
								}
							}
						}
					}
				}
				else_if = {
					limit = {
						d_red_tiger = {
							title = PREV
						}
					}
					if = {
						limit = {
							ROOT = {
								trait = uthgar_red_tiger
							}
						}
						ROOT = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
						}
					}
					else_if = {
						limit = {
							ROOT = {
								NOT = { trait = uthgar_red_tiger }
							}
						}
						create_character = {
							age = 25
							trait = creature_human
							trait = uthgar_red_tiger
							female = random
							religion = uthgardt_faith
							culture = uthgardt
							dynasty = actually_culture
							random_traits = yes
						}
						new_character = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
							usurp_title = {
								target = PREV
								type = holy_war
							}
							if = {
								limit = {
									ROOT = {
										higher_tier_than = DUKE
									}
								}
								set_defacto_liege = ROOT
							}
							else_if = {
								limit = {
									ROOT = {
										NOT = { higher_tier_than = DUKE }
									}
								}
								add_alliance = {
									who = ROOT
									years = 999
								}
							}
						}
					}
				}
				else_if = {
					limit = {
						d_sky_pony = {
							title = PREV
						}
					}
					if = {
						limit = {
							ROOT = {
								trait = uthgar_sky_pony
							}
						}
						ROOT = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
						}
					}
					else_if = {
						limit = {
							ROOT = {
								NOT = { trait = uthgar_sky_pony }
							}
						}
						create_character = {
							age = 25
							trait = creature_human
							trait = uthgar_sky_pony
							female = random
							religion = uthgardt_faith
							culture = uthgardt
							dynasty = actually_culture
							random_traits = yes
						}
						new_character = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
							usurp_title = {
								target = PREV
								type = holy_war
							}
							if = {
								limit = {
									ROOT = {
										higher_tier_than = DUKE
									}
								}
								set_defacto_liege = ROOT
							}
							else_if = {
								limit = {
									ROOT = {
										NOT = { higher_tier_than = DUKE }
									}
								}
								add_alliance = {
									who = ROOT
									years = 999
								}
							}
						}
					}
				}
				else_if = {
					limit = {
						d_thunderbeast = {
							title = PREV
						}
					}
					if = {
						limit = {
							ROOT = {
								trait = uthgar_thunderbeast
							}
						}
						ROOT = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
						}
					}
					else_if = {
						limit = {
							ROOT = {
								NOT = { trait = uthgar_thunderbeast }
							}
						}
						create_character = {
							age = 25
							trait = creature_human
							trait = uthgar_thunderbeast
							female = random
							religion = uthgardt_faith
							culture = uthgardt
							dynasty = actually_culture
							random_traits = yes
						}
						new_character = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
							usurp_title = {
								target = PREV
								type = holy_war
							}
							if = {
								limit = {
									ROOT = {
										higher_tier_than = DUKE
									}
								}
								set_defacto_liege = ROOT
							}
							else_if = {
								limit = {
									ROOT = {
										NOT = { higher_tier_than = DUKE }
									}
								}
								add_alliance = {
									who = ROOT
									years = 999
								}
							}
						}
					}
				}
				else_if = {
					limit = {
						d_tree_ghost = {
							title = PREV
						}
					}
					if = {
						limit = {
							ROOT = {
								trait = uthgar_tree_ghost
							}
						}
						ROOT = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
						}
					}
					else_if = {
						limit = {
							ROOT = {
								NOT = { trait = uthgar_tree_ghost }
							}
						}
						create_character = {
							age = 25
							trait = creature_human
							trait = uthgar_tree_ghost
							female = random
							religion = uthgardt_faith
							culture = uthgardt
							dynasty = actually_culture
							random_traits = yes
						}
						new_character = {
							vassalize_or_take_under_title = {
								title = PREV
								enemy = FROM
								same_religion = yes # Only vassalize rulers of my religion
								is_religious = yes
								type = holy_war
							}
							usurp_title = {
								target = PREV
								type = holy_war
							}
							if = {
								limit = {
									ROOT = {
										higher_tier_than = DUKE
									}
								}
								set_defacto_liege = ROOT
							}
							else_if = {
								limit = {
									ROOT = {
										NOT = { higher_tier_than = DUKE }
									}
								}
								add_alliance = {
									who = ROOT
									years = 999
								}
							}
						}
					}
				}
			}
		}
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			piety = -50
			prestige = -100
		}
	}

	on_reverse_demand = {
		if = {
			limit = {
				FROM = {
					trait = patron_hoar
					is_rival = ROOT
				}
			}
			FROM = { piety = 40 }
		}
		ROOT = {
			show_scope_change = no
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			piety = -75
			prestige = -150
		}
		FROM = {
			participation_scaled_piety = 200
			participation_scaled_prestige = 100
			if = {
				limit = {
					uses_decadence = yes
				}
				participation_scaled_decadence = -10
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_piety = 200
				participation_scaled_prestige = 100
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -10
				}
				hidden_tooltip = {
					if = {
						limit = {
							has_ambition = obj_strengthen_religion
						}
						change_variable = { which = strengthen_religion value = 1 }
					}
				}
			}
		}
		any_attacker = {
			limit = {
				character = ROOT
				uses_decadence = yes
				NOT = {
					any_liege = {
						dynasty = PREV
					}
				}
			}
			participation_scaled_decadence = 20
		}
		any_attacker = {
			limit = {
				NOT = { character = ROOT }
				uses_decadence = yes
				NOT = {
					any_liege = {
						dynasty = PREV
					}
				}
			}
			hidden_tooltip = {
				participation_scaled_decadence = 20
			}
		}
		ROOT = {
			religion_authority = {
				modifier = lost_holy_war
				years = 20
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = {
			factor = 0.2
			ROOT = { trait = cynical }
		}
		modifier = {
			factor = 0.2
			ROOT = { trait = slothful }
		}
		modifier = {
			factor = 0.2
			ROOT = { trait = craven }
		}
	}
}