namespace = ELDC

########################JOINING ELDER CONCORD############################

#From on_character_ask_to_join_society
character_event = {
    id = ELDC.100
    hide_window = yes
    is_triggered_only = yes
    trigger = {
    	FROM = { leader = { society_member_of = elder_concord } }
    }
    immediate = {
    	if = { #Find a non-prisoner member
    		limit = { FROM = { leader = { prisoner = yes } } }
    		FROM = {
    			any_society_member = {
    				limit = {
    					society_member_of = elder_concord
    					society_rank == 4
    					prisoner = no
    				}
    				character_event = { id = ELDC.101 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = elder_concord
    					society_rank == 3
    					prisoner = no
    				}
    				character_event = { id = ELDC.101 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = elder_concord
    					society_rank == 2
    					prisoner = no
    				}
    				character_event = { id = ELDC.101 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = elder_concord
    					society_rank == 1
    					prisoner = no
    				}
    				character_event = { id = ELDC.101 }
    				break = yes
    			}
    		}
			#Everyone is somehow in prison so just use teh leader anyway
    	}
    	FROM = { leader = { character_event = { id = ELDC.101 } } }
    }
}

#Ping event
character_event = {
    id = ELDC.101
    hide_window = yes
    is_triggered_only = yes
    immediate = {
    	FROM = { letter_event = { id = ELDC.102 } }
    }
}

#Welcome letter
letter_event = {
    id = ELDC.102
    desc = EVTDESC_ELDC_102
    border = GFX_event_letter_frame_religion

    is_triggered_only = yes

    immediate = { set_character_flag = society_join_block }

    option = {
      name = EVTOPTA_ELDC_102

      join_society = elder_concord
      clr_character_flag = society_join_block
    }
}

########################AI JOIN AND AI RANK UP ELDER CONCORD###########################

character_event = { #force the AI to join a society
  id = ELDC.110
  hide_window = yes
  is_triggered_only = yes

	immediate = {
		if = {
			limit = { #if he's already a member, will force a rank up 25% of the time
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				higher_tier_than = BARON
				society_member_of = elder_concord
				society_rank <= 3
				society_can_rank_up = yes
			}
			random_list = {
				75 = {}
				25 = {
					society_rank_up = 1
				}
			}
		}
		if = { #force the joining event on AI
      limit = {
        ai = yes
        prisoner = no
        NOT = { trait = incapable }
        is_adult = yes
        is_in_society = no
        controls_religion = no
        block_general_event_trigger = no
      }
			character_event = { id = ELDC.111 }
		}
	}
}

character_event = { #AI join event
	id = ELDC.111
	hide_window = yes

	is_triggered_only = yes

  immediate = {
    random_list = {
      60 = { # do nothing
      }
      40 = {
        trigger = { #meet the requirement
          can_join_society = elder_concord
        }
        modifier = {
          factor = 10
          trait = creature_elder_brain
        }
        modifier = {
          factor = 2
          trait = creature_ulitharid
        }
        modifier = {
          factor = 2
					OR = {
            trait = scholar
            trait = theologian
            trait = administrator
						trait = architect
						trait = mystic
          }
        }
        modifier = {
          factor = 2
					OR = {
            trait = impaler
            trait = cruel
          }
        }
				modifier = {
          factor = 2
          trait = zealous
        }
				modifier = {
          factor = 2
          trait = erudite
        }
        modifier = {
          factor = 0.2
          OR = {
            trait = cynical
            trait = kind
            trait = charitable
          }
        }
        modifier = {
          factor = 0.1
          is_landed = no
        }
        join_society = elder_concord
        random_list = {
          75 = {
            modifier = {
              factor = 0
              society_influence >= 30
            }
          }
          25 = {
          }
        }
        if = { # Make grandmaster is there is none
          limit = {
            NOT = {
              society = {
                any_society_member = {
                  is_society_grandmaster = yes
                }
              }
            }
          }
          set_society_grandmaster = yes
        }
      }
    }
  }
}


#################################DECISIONS######################################

# ruthless taxation
character_event = {
	id = ELDC.2000
	desc = EVTDESC_ELDC_2000
	picture = GFX_evt_mind_flayers_2

	is_triggered_only = yes

	# Exploit Demesne Province
	option = {
		name = EVTOPTA_ELDC_2000

		ai_chance = {
			factor = 100
		}

		trigger = {
			event_target:extra_tax_target = { always = yes }
		}

    custom_tooltip = {
      text = extort_zhent_custom_tooltip
      hidden_tooltip = {
        any_realm_character = {
          limit = {
            OR = {
              olrox_is_good_religion_trigger = yes
              trait = kind
              trait = charitable
            }
            NOR = {
              trait = cruel
              trait = greedy
            }
          }
          opinion = {
            who = ROOT
            modifier = opinion_tyrant
            months = 60
          }
        }
      }
    }
		character_event = {	id = ELDC.2001 }
  }

  # Give Up
	option = {
		name = EVTOPTB_ELDC_2000

		ai_chance = {
			factor = 0
		}
    add_society_currency_minor_effect = yes
  }
}

# Exploit Demesne Province
character_event = {
  id = ELDC.2001
  desc = EVTDESC_ELDC_2001
  picture = GFX_evt_mind_flayers_2

  is_triggered_only = yes

  # first option High stewardship
  option = {
    name = EVTOPTA_ELDC_2001
    tooltip_info = stewardship

    trigger = {
      stewardship = 15
    }

    event_target:extra_tax_target = {
      add_province_modifier = {
        modifier = exploit_economy_trade
        duration = 1825
      }
    }
  }

  # second option locals upset
  option = {
    name = EVTOPTB_ELDC_2001

    event_target:extra_tax_target = {
      add_province_modifier = {
        modifier = ruthless_tax
        duration = 1825
      }
    }

    if = {
      limit = {
        event_target:extra_tax_target = {
          num_of_settlements = 7
        }
      }
      wealth = 150
      break = yes
    }
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 6
					}
				}
			wealth = 130
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 5
					}
				}
			wealth = 110
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 4
					}
				}
			wealth = 90
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 3
					}
				}
			wealth = 70
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 2
					}
				}
			wealth = 50
			break = yes
		}
    wealth = 30
  }

  # third option High diplo
  option = {
    name = EVTOPTC_ELDC_2001
    tooltip_info = diplomacy

    trigger = {
      diplomacy = 15
    }

    event_target:extra_tax_target = {
      add_province_modifier = {
        modifier = exploit_economy_intimidation
        duration = 2555
      }
    }
  }
}
