# Faerun - polyamory events - by neutrondecay & teneb

namespace = polyam

# Meet the lover - two metamours are introduced as such for the first time

# begin by setting the scopes

character_event = {
	id = polyam.1
	hide_window = yes
	is_triggered_only = yes
	capable_only = yes
	prisoner = no
	min_age = 16
	trigger = {
		OR = {
			any_lover = {
				NOT = {	character = event_target:polyam_newcomer }
				is_metamour_of_root = no
			}
			any_spouse = {
				NOT = {	character = event_target:polyam_newcomer }
				is_metamour_of_root = no
			}
			any_consort = {
				NOT = {	character = event_target:polyam_newcomer }
				is_metamour_of_root = no
			}
		}
		NOT = { is_inaccessible_trigger = yes }
	}
	immediate = {
		any_spouse = {
			limit = {
				NOT = { character = event_target:polyam_newcomer }
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			character_event = {
				id = polyam.2
				days = 10
				random = 15
			}
		}
		any_consort = {
			limit = {
				NOT = { character = event_target:polyam_newcomer }
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			character_event = {
				id = polyam.2
				days = 25
				random = 15
			}
		}
		any_lover = {
			limit = {
				NOT = { character = event_target:polyam_newcomer }
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			character_event = {
				id = polyam.2
				days = 40
				random = 15
			}
		}
	}
}

character_event = {
	id = polyam.2
	is_triggered_only = yes
	desc = {
		text = EVTDESC_POLYAM_2
		trigger = {
			NOR = {
				is_friend = polyam_newcomer
				is_lover = polyam_newcomer
			}
		}
	}
	desc = {
		text = EVTDESC_POLYAM_2_FRIENDS
		trigger = {
			is_friend = polyam_newcomer
			NOT = { is_lover = polyam_newcomer }
		}
	}
	desc = {
		text = EVTDESC_POLYAM_2_LOVERS
		trigger = {
			is_lover = polyam_newcomer
		}
	}
	picture = GFX_evt_gossip_1
	immediate = {
		save_event_target_as = polyam_established
	}
	option = {
		name = EVTOPTA_POLYAM_2 # Terrible news!
		trigger = {
			OR = {
				religion_has_polyamory = no
				NOR = {
					is_friend = polyam_newcomer
					is_lover = polyam_newcomer
				}
			}
		}
		ai_chance = {
			factor = 10.0
			modifier = {
				factor = 0.2
				event_target:polyam_newcomer = { 
					OR = {
						trait = kind 
						trait = temperate
					}
				}
			}
			modifier = {
				factor = 3.0
				event_target:polyam_newcomer = { 
					OR = {
						trait = envious
						trait = proud
					}
				}
			}
			modifier = {
				factor = 5.0
				event_target:polyam_newcomer = { 
					OR = {
						trait = wroth
						trait = cruel
					}
				}
			}
			modifier = {
				factor = 0.2
				trait = kind
			}
			modifier = {
				factor = 10.0
				is_rival = event_target:polyam_newcomer
			}
			modifier = {
				factor = 3.5
				OR = {
					trait = envious
					trait = proud
				}
			}
			modifier = {
				factor = 4.0
				religion_has_polyamory = no
			}
		}
		opinion = {
			name = opinion_unpopular_metamour
			who = event_target:polyam_newcomer
		}
		FROM = {
			character_event = { id = polyam.3 }
		}
	}
	option = {
		name = EVTOPTB_POLYAM_2 # This is fine.
		ai_chance = {
			factor = 50.0
			modifier = {
				factor = 0.3
				trait = wroth
			}
			modifier = {
				factor = 2.5
				trait = content
			}
		}
		opinion = {
			name = opinion_accepted_metamour
			who = event_target:polyam_newcomer
		}
		FROM = {
			character_event = { id = polyam.4 }
		}
	}
	option = {
		name = EVTOPTC_POLYAM_2 # A good choice!
		ai_chance = {
			factor = 10.0
			modifier = {
				factor = 2.5
				event_target:polyam_newcomer = { 
					OR = {
						trait = kind 
						trait = temperate
					}
				}
			}
			modifier = {
				factor = 0.3
				event_target:polyam_newcomer = { 
					OR = {
						trait = envious
						trait = proud
					}
				}
			}
			modifier = {
				factor = 0.02
				event_target:polyam_newcomer = { 
					OR = {
						trait = wroth
						trait = cruel
					}
				}
			}
			modifier = {
				factor = 0.3
				trait = proud
			}
			modifier = {
				factor = 1.5
				trait = lustful
			}
			modifier = {
				factor = 10.0
				is_lover = event_target:polyam_newcomer
			}
			modifier = {
				factor = 5.0
				is_friend = event_target:polyam_newcomer
			}
			modifier = {
				factor = 1.5
				trait = charitable
			}
		}
		opinion = {
			name = opinion_popular_metamour
			who = event_target:polyam_newcomer
		}
		FROM = {
			character_event = { id = polyam.5 }
		}
	}
	option = {
		name = EVTOPTD_POLYAM_2 # That's my kin
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.02
				event_target:polyam_newcomer = { 
					religion_has_incest = yes
				}
				religion_has_incest = yes
			}
		}
		FROM = {
			character_event = { id = polyam.3 }
		}
	}
}
character_event = { # Bad initial reaction reported to central partner
	id = polyam.3
	is_triggered_only = yes
	desc = {
		text = EVTDESC_POLYAM_3
	}
	picture = GFX_evt_quarrel
	option = {
		name = EVTOPTA_POLYAM_3
		event_target:polyam_newcomer = {
			character_event = { id = polyam.6 }
		}
	}
}


character_event = { # Neutral reaction reported to central partner
	id = polyam.4
	is_triggered_only = yes
	desc = {
		text = EVTDESC_POLYAM_4
	}
	picture = GFX_evt_gossip_1
	option = {
		name = EVTOPTA_POLYAM_4
		event_target:polyam_newcomer = {
			character_event = { id = polyam.7 }
		}
	}
}

character_event = { # Positive reaction reported to central partner
	id = polyam.5
	is_triggered_only = yes
	desc = {
		text = EVTDESC_POLYAM_5
	}
	picture = GFX_evt_lovers
	option = {
		name = EVTOPTA_POLYAM_5
		event_target:polyam_newcomer = {
			character_event = { id = polyam.8 }
		}
	}
}

character_event = { # Negative reaction reported to newcomer
	id = polyam.6
	is_triggered_only = yes
	desc = {
		text = EVTDESC_POLYAM_6
	}
	picture = GFX_evt_quarrel
	option = { # screw you too
		name = EVTOPTA_POLYAM_6
		ai_chance = {
			factor = 75.0
			modifier = {
				factor = 0.5
				OR = {
					trait = kind
					trait = patient
				}
			}
			modifier = {
				factor = 5.0
				OR = {
					trait = wroth
					trait = envious
					trait = proud
				}
			}
			modifier = {
				factor = 4.0
				religion_has_polyamory = no
			}
		}
		opinion = {
			name = opinion_unpopular_metamour
			who = event_target:polyam_established
		}
	}
	option = { # we can keep the peace
		name = EVTOPTB_POLYAM_6
		ai_chance = {
			factor = 10.0
			modifier = {
				factor = 1.5
				OR = {
					trait = content
					trait = temperate
				}
			}
		}
		opinion = {
			name = opinion_accepted_metamour
			who = event_target:polyam_established
		}
	}
	option = { # I shall be good
		name = EVTOPTC_POLYAM_6
		ai_chance = {
			factor = 0 # Never ever
		}
		opinion = {
			name = opinion_popular_metamour
			who = event_target:polyam_established
		}
	}
}
character_event = { # Neutral reaction reported to newcomer
	id = polyam.7
	is_triggered_only = yes
	desc = {
		text = EVTDESC_POLYAM_7
	}
	picture = GFX_evt_gossip_1
	option = { # Not to my taste
		name = EVTOPTA_POLYAM_7
		ai_chance = {
			factor = 10.0
			modifier = {
				factor = 0.2
				OR = {
					trait = kind
					trait = patient
				}
			}
			modifier = {
				factor = 5.0
				OR = {
					trait = wroth
					trait = envious
					trait = proud
				}
			}
			modifier = {
				factor = 4.0
				religion_has_polyamory = no
			}
		}
		opinion = {
			name = opinion_unpopular_metamour
			who = event_target:polyam_established
		}
	}
	option = { # We shall do well
		name = EVTOPTB_POLYAM_7
		ai_chance = {
			factor = 60.0
			modifier = {
				factor = 1.5
				OR = {
					trait = content
					trait = patient
					trait = kind
				}
			}
		}
		opinion = {
			name = opinion_accepted_metamour
			who = event_target:polyam_established
		}
	}
	option = { # I can do better
		name = EVTOPTC_POLYAM_7
		ai_chance = {
			factor = 15.0
			modifier = {
				factor = 5.0
				OR = {
					trait = charitable
					trait = temperate
				}
			}
		}
		opinion = {
			name = opinion_popular_metamour
			who = event_target:polyam_established
		}
	}
}
character_event = { # Positive reaction reported to newcomer
	id = polyam.8
	is_triggered_only = yes
	desc = {
		text = EVTDESC_POLYAM_8
	}
	picture = GFX_evt_lovers
	option = { # Throw it back
		name = EVTOPTA_POLYAM_8
		ai_chance = {
			factor = 25.0
			modifier = {
				factor = 0
				religion_has_polyamory = yes
			}
		}
		opinion = {
			name = opinion_unpopular_metamour
			who = event_target:polyam_established
		}
	}
	option = { # They're fine, I suppose
		name = EVTOPTB_POLYAM_8
		ai_chance = {
			factor = 15.0
			modifier = {
				factor = 2.5
				OR = {
					trait = arbitrary
					trait = chaste
					trait = cynical
				}
			}
		}
		opinion = {
			name = opinion_accepted_metamour
			who = event_target:polyam_established
		}
	}
	option = { # We shall be bosom friends
		name = EVTOPTC_POLYAM_8
		ai_chance = {
			factor = 50.0
			modifier = {
				factor = 2.0
				OR = {
					trait = lustful
					trait = gregarious
				}
			}
			modifier = {
				factor = 10.0
				is_lover = event_target:polyam_established
			}
			modifier = {
				factor = 5.0
				is_friend = event_target:polyam_established
			}				
		}
		opinion = {
			name = opinion_popular_metamour
			who = event_target:polyam_established
		}
	}
	after = {
		event_target:polyam_newcomer = {
			character_event = {
				id = polyam.9
				months = 1
				random = 90
			}
		}
	}
}

# metamour reactions
# we begin by checking for metamour status and if they've been through this event together
character_event = {
	id = polyam.9
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				NOT = {
					has_opinion_modifier = {
						name = opinion_metamour_check
						who = event_target:polyam_established
					}
				}
			}
			break = yes
		}
		if = {
			limit = {
				has_opinion_modifier = {
					name = opinion_unpopular_metamour
					who = event_target:polyam_established
				}
				NOT = { rival = event_target:polyam_established }
			}
			character_event = { id = polyam.10 }
			event_target:polyam_established = { id = polyam.10 }
		}
		else_if = {
			limit = {
				has_opinion_modifier = {
					name = opinion_popular_metamour
					who = event_target:polyam_established
				}
			}
			if = {
				limit = {
					event_target:polyam_established = { is_romance_compatible_with_root = yes }
				}
				character_event = { id = polyam.11 }
				event_target:polyam_established = { id = polyam.11 }
			}
			else = {
				character_event = { id = polyam.12 }
				event_target:polyam_established = { id = polyam.12 }
			}
		}
	}
}

character_event = {
	id = polyam.10
	desc = {
		trigger = {
			NOT = { character = event_target:polyam_established }
		}
		text = EVTDESCA_POLYAM_10 # can't stand them, etc etc
	}
	desc = {
		trigger = {
			character = event_target:polyam_established
		}
		text = EVTDESCB_POLYAM_10 # as above, just change the names
	}
	picture = GFX_evt_quarrel
	
	option = {
		name = EVTOPTA_POLYAM_10 # something rivalryesque
		event_target:polyam_newcomer = {
			event_target:polyam_established = {
				add_rival = event_target:polyam_newcomer
			}
		}
	}
}

character_event = {
	id = polyam.11
	desc = {
		trigger = {
			NOT = { character = event_target:polyam_established }
		}
		text = EVTDESCA_POLYAM_11 # something about becoming friend, etc etc
	}
	desc = {
		trigger = {
			character = event_target:polyam_established
		}
		text = EVTDESCB_POLYAM_11 # as above, just change the names
	}
	
	option = {
		name = EVTOPTA_POLYAM_11 # something friendlyesque
		event_target:polyam_newcomer = {
			event_target:polyam_established = {
				add_friend = event_target:polyam_newcomer
			}
		event_target:polyam_newcomer = {
	}
}

character_event = {
	id = polyam.12
	desc = {
		trigger = {
			NOT = { character = event_target:polyam_established }
		}
		text = EVTDESCA_POLYAM_12 # something about becoming lovers, etc etc
	}
	desc = {
		trigger = {
			character = event_target:polyam_established
		}
		text = EVTDESCB_POLYAM_12 # as above, just change the names
	}
	
	option = {
		name = EVTOPTA_POLYAM_12 # something loveryesque
		event_target:polyam_newcomer = {
			event_target:polyam_established = {
				add_lover = event_target:polyam_newcomer
			}
		}
	}
}