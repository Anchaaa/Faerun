namespace = tbminorstory

#Daemonfey Awaken
narrative_event = {
	id = tbminorstory.1
	title = FEYRISTORYT.1
	desc = FEYRISTORY.1
	picture = GFX_evt_sarya

	is_triggered_only = yes

	trigger = {
		NOT = { has_landed_title = d_scoured_legion }
		FROMFROM = { has_landed_title = d_scoured_legion }
		FROM = { title = c_upvale }
		NOT = { has_global_flag = daemonfey_released }
		NOT = {
			has_game_rule = {
				name = minor_story_events
				value = off
			}
		}
	}

	immediate = {
		if = {
			limit = {
				NOT = { culture_group = draconic_group }
			}
			c_upvale = {
				location = {
					culture = ROOT
					religion = ROOT
				}
			}
		}
		else = {
			capital_scope = {
				c_upvale = {
					location = {
						culture = PREVPREV
						religion = ROOT
					}
				}
			}
		}
	}

	option = {
		name = FEYRISTORY.1.a
		set_global_flag = daemonfey_released
		create_character = {
			age = 1350
			name = Sarya
			dynasty = 2
			attributes = {
				martial = 5
				diplomacy = 8
				learning = 15
				intrigue = 7
				stewardship = 6
			}
			female = yes
			culture = feyri
			religion = ghaunadaur
			immortal_age = 30
			add_trait = renowned_sorcerer
			add_trait = origin_shadow
			add_trait = creature_feyri
			add_trait = grey_eminence
			add_trait = lustful
			add_trait = cruel
			add_trait = ambitious
			add_trait = diligent
			add_trait = wroth
			add_trait = impaler
			add_trait = fair
			add_trait = immortal
			add_trait = bio_sarya
			add_trait = legit_bastard
		}
		new_character = {
			set_father = 66219
			set_mother = 25
			set_character_flag = sorc_originrevealed
			character_event = { id = sorcinit.1 days = 1 }
			character_event = { id = tbminorstory.3 days = 1 }
			wealth = 500
			create_title = {
				tier = DUKE
				landless = yes
				culture = feyri
				name = DAEMONFEY
				holder = THIS
				short_name = yes
			}
			d_eaerlann = {
				add_claim = PREV
			}
			c_upvale = {
				add_claim = PREV
			}
			d_cormanthor = {
				add_claim = PREV
			}
			c_myth_drannor = {
				add_claim = PREV
			}
			create_character = {
				age = 1320
				name = Xalph
				dynasty = 2
				attributes = {
					martial = 8
					diplomacy = 4
					learning = 8
					intrigue = 7
					stewardship = 4
				}
				culture = feyri
				religion = ghaunadaur
				immortal_age = 30
				add_trait = creature_feyri
				add_trait = tough_soldier
				add_trait = cruel
				add_trait = ambitious
				add_trait = deceitful
				add_trait = greedy
				add_trait = pretty
				add_trait = expert_fighter
				add_trait = legit_bastard
			}
			new_character = {
				set_mother = PREV
				set_father = 66218
			}
			create_character = {
				age = 1310
				name = Ryvik
				dynasty = 2
				attributes = {
					martial = 5
					diplomacy = 6
					learning = 8
					intrigue = 10
					stewardship = 6
				}
				culture = feyri
				religion = ghaunadaur
				immortal_age = 30
				add_trait = creature_feyri
				add_trait = flamboyant_schemer
				add_trait = cruel
				add_trait = ambitious
				add_trait = schemer
				add_trait = deceitful
				add_trait = arbitrary
				add_trait = weak
				add_trait = bright
				add_trait = expert_sorcerer #no psionics yet
				add_trait = origin_aberrant_mind #closest thing to psions
				add_trait = legit_bastard
			}
			new_character = {
				set_mother = PREV
				set_father = 66220
				set_character_flag = sorc_originrevealed
				character_event = { id = sorcinit.1 days = 1 }
			}
			create_character = {
				age = 1300
				name = Xhalth
				dynasty = 2
				attributes = {
					martial = 12
					diplomacy = 4
					learning = 4
					intrigue = 7
					stewardship = 5
				}
				culture = feyri
				religion = ghaunadaur
				immortal_age = 30
				add_trait = creature_feyri
				add_trait = skilled_tactician
				add_trait = cruel
				add_trait = ambitious
				add_trait = stubborn
				add_trait = proud
				add_trait = wroth
				add_trait = strong
				add_trait = expert_barbarian
				add_trait = legit_bastard
			}
			new_character = {
				set_mother = 66217
				set_father = 24
			}
			create_character = {
				age = 1315
				name = Saelethil
				dynasty = 2
				culture = feyri
				religion = ghaunadaur
				immortal_age = 30
				add_trait = creature_feyri
				add_trait = mastermind_theologian
				add_trait = deceitful
				add_trait = renowned_wizard
				add_trait = legit_bastard
			}
			new_character = {
				set_mother = PREV
				set_father = 66218
				#character_event = { id = wizinit.1 days = 1 }
			}
			if = {
				limit = {
					has_game_rule = {
						name = minor_story_events
						value = on
					}
				}
				spawn_unit = {
					province = FROM
					home = FROM
					owner = THIS
					leader = THIS
					troops = {
						archers = { 400 400 }
						mages_troops = { 50 50 }
						light_infantry = { 800 800 }
						heavy_infantry = { 300 300 }
						light_cavalry = { 200 200 }
					}
					cannot_inherit = yes
					attrition = 0.2
					disband_on_peace = no
					maintenance_multiplier = 0.15
					can_toggle_looting = no
					merge = yes
					reinforces = no
				}
				spawn_unit = {
					province = FROM
					home = FROM
					owner = THIS
					leader = THIS
					troops = {
						archers = { 400 400 }
						mages_troops = { 50 50 }
						light_infantry = { 800 800 }
						heavy_infantry = { 300 300 }
						light_cavalry = { 200 200 }
					}
					cannot_inherit = yes
					attrition = 0.2
					disband_on_peace = no
					maintenance_multiplier = 0.15
					can_toggle_looting = no
					merge = yes
					reinforces = no
				}
				spawn_unit = {
					province = FROM
					home = FROM
					owner = THIS
					leader = THIS
					troops = {
						archers = { 400 400 }
						mages_troops = { 50 50 }
						light_infantry = { 800 800 }
						heavy_infantry = { 300 300 }
						light_cavalry = { 200 200 }
					}
					cannot_inherit = yes
					attrition = 0.2
					disband_on_peace = no
					maintenance_multiplier = 0.15
					can_toggle_looting = no
					merge = yes
					reinforces = no
				}
			}
			else_if = {
				limit = {
					has_game_rule = {
						name = minor_story_events
						value = dangerous
					}
				}
				spawn_unit = {
					province = FROM
					home = FROM
					owner = THIS
					leader = THIS
					troops = {
						archers = { 200 200 }
						mages_troops = { 65 65 }
						heavy_infantry = { 800 800 }
					}
					cannot_inherit = yes
					attrition = 0.2
					disband_on_peace = no
					maintenance_multiplier = 0.15
					can_toggle_looting = no
					merge = yes
					reinforces = no
				}
				spawn_unit = {
					province = FROM
					home = FROM
					owner = THIS
					leader = THIS
					troops = {
						archers = { 200 200 }
						mages_troops = { 65 65 }
						heavy_infantry = { 800 800 }
					}
					cannot_inherit = yes
					attrition = 0.2
					disband_on_peace = no
					maintenance_multiplier = 0.15
					can_toggle_looting = no
					merge = yes
					reinforces = no
				}
				spawn_unit = {
					province = FROM
					home = FROM
					owner = THIS
					leader = THIS
					troops = {
						archers = { 200 200 }
						mages_troops = { 65 65 }
						heavy_infantry = { 800 800 }
					}
					cannot_inherit = yes
					attrition = 0.2
					disband_on_peace = no
					maintenance_multiplier = 0.15
					can_toggle_looting = no
					merge = yes
					reinforces = no
				}
			}
			else_if = {
				limit = {
					has_game_rule = {
						name = minor_story_events
						value = lethal
					}
				}
				spawn_unit = {
					province = FROM
					home = FROM
					owner = THIS
					leader = THIS
					troops = {
						archers = { 400 400 }
						mages_troops = { 130 130 }
						heavy_infantry = { 1600 1600 }
					}
					cannot_inherit = yes
					attrition = 0.2
					disband_on_peace = no
					maintenance_multiplier = 0.15
					can_toggle_looting = no
					merge = yes
					reinforces = yes
					reinforce_rate_multiplier = 0.2
				}
				spawn_unit = {
					province = FROM
					home = FROM
					owner = THIS
					leader = THIS
					troops = {
						archers = { 400 400 }
						mages_troops = { 130 130 }
						heavy_infantry = { 1600 1600 }
					}
					cannot_inherit = yes
					attrition = 0.2
					disband_on_peace = no
					maintenance_multiplier = 0.15
					can_toggle_looting = no
					merge = yes
					reinforces = yes
					reinforce_rate_multiplier = 0.2
				}
				spawn_unit = {
					province = FROM
					home = FROM
					owner = THIS
					leader = THIS
					troops = {
						archers = { 400 400 }
						mages_troops = { 130 130 }
						heavy_infantry = { 1600 1600 }
					}
					cannot_inherit = yes
					attrition = 0.2
					disband_on_peace = no
					maintenance_multiplier = 0.15
					can_toggle_looting = no
					merge = yes
					reinforces = yes
					reinforce_rate_multiplier = 0.2
				}
			}
		}
		hidden_tooltip = {
			any_playable_ruler = {
				limit = {
					ai = no
					NOT = { character = ROOT }
					is_within_diplo_range = ROOT
				}
				narrative_event = { id = tbminorstory.2 }
			}
		}
	}
}

narrative_event = {
	id = tbminorstory.2
	title = FEYRISTORYT.1
	desc = FEYRISTORY.2
	picture = GFX_evt_sarya

	is_triggered_only = yes

	option = {
		name = FEYRISTORY.2.a
	}
}

character_event = {
	id = tbminorstory.3
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		c_upvale = {
			holder_scope = {
				reverse_unsafe_war = {
					target = ROOT
					casus_belli = invasion
					thirdparty = ROOT
					thirdparty_title = PREV
				}
			}
		}
	}
}

narrative_event = {
	id = tbminorstory.4
	title = MOANDERSTORYT.1
	desc = MOANDERSTORYD.2
	picture = GFX_evt_abyss_1
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = moander_rampaged}
		NOT = {
			has_game_rule = {
				name = minor_story_events
				value = off
			}
		}
		has_landed_title = c_yulash
		year = 1357
		month = 4
	}
	
	immediate = {
		set_global_flag = moander_rampaged
	}
	
	option = {
		name = MOANDERSTORYO.2
		c_yulash = {
			location = {
				if = {
					limit = {
						AND = {
							has_dlc = "Reapers"
							NOR = {
								has_province_modifier = depopulated_1
								has_province_modifier = depopulated_2
								has_province_modifier = depopulated_3
							}
						}
					}
					if = {
						limit = {
							NOR = {
								has_province_modifier = depopulated_1
								has_province_modifier = depopulated_2
								has_province_modifier = depopulated_3
							}
						}
						add_province_modifier = {
							name = depopulated_1
							duration = -1
						}
					}
					else_if = {
						limit = { has_province_modifier = depopulated_1 }
						add_province_modifier = {
							name = depopulated_2
							duration = -1
						}
					}
					else_if = {
						limit = { has_province_modifier = depopulated_2 }
						add_province_modifier = {
							name = depopulated_3
							duration = -1
						}
					}
				}
				else = {
					add_province_modifier = {
						name = moanders_road
						years = 1
					}
				}
			}
		}
	}
	
	after = {
		c_greentree = {
			holder_scope = {
				narrative_event = { id = tbminorstory.5 days = 5 }
			}
		}
		any_playable_ruler = {
			limit = {
				NOT = { has_landed_title = c_yulash }
				ai = no
				OR = {
					region = moonsea_region
					any_realm_province = {
						region = moonsea_region
					}
				}
			}
			narrative_event = { id = tbminorstory.8 }
		}
	}
}

narrative_event = {
	id = tbminorstory.5
	title = MOANDERSTORYT.1
	desc = MOANDERSTORYD.2
	picture = GFX_evt_abyss_1
	
	is_triggered_only = yes
	
	option = {
		name = MOANDERSTORYO.2
		c_greentree = {
			location = {
				if = {
					limit = {
						AND = {
							has_dlc = "Reapers"
							NOR = {
								has_province_modifier = depopulated_1
								has_province_modifier = depopulated_2
								has_province_modifier = depopulated_3
							}
						}
					}
					if = {
						limit = {
							NOR = {
								has_province_modifier = depopulated_1
								has_province_modifier = depopulated_2
								has_province_modifier = depopulated_3
							}
						}
						add_province_modifier = {
							name = depopulated_1
							duration = -1
						}
					}
					else_if = {
						limit = { has_province_modifier = depopulated_1 }
						add_province_modifier = {
							name = depopulated_2
							duration = -1
						}
					}
					else_if = {
						limit = { has_province_modifier = depopulated_2 }
						add_province_modifier = {
							name = depopulated_3
							duration = -1
						}
					}
				}
				else = {
					add_province_modifier = {
						name = moanders_road
						years = 1
					}
				}
			}
		}
	}
	
	after = {
		c_myth_drannor = {
			holder_scope = {
				narrative_event = { id = tbminorstory.6 days = 5 }
			}
		}
		any_playable_ruler = {
			limit = {
				NOT = { has_landed_title = c_greentree }
				ai = no
				OR = {
					region = cormanthor_region
					region = dalelands_region
					any_realm_province = {
						OR = {
							region = cormanthor_region
							region = dalelands_region
						}
					}
				}
			}
			narrative_event = { id = tbminorstory.9 }
		}
	}
}

narrative_event = {
	id = tbminorstory.6
	title = MOANDERSTORYT.1
	desc = MOANDERSTORYD.3
	picture = GFX_evt_abyss_1
	
	is_triggered_only = yes
	
	option = {
		name = MOANDERSTORYO.3
		c_myth_drannor = {
			location = {
				if = {
					limit = {
						AND = {
							has_dlc = "Reapers"
							NOR = {
								has_province_modifier = depopulated_1
								has_province_modifier = depopulated_2
								has_province_modifier = depopulated_3
							}
						}
					}
					if = {
						limit = {
							NOR = {
								has_province_modifier = depopulated_1
								has_province_modifier = depopulated_2
								has_province_modifier = depopulated_3
							}
						}
						add_province_modifier = {
							name = depopulated_1
							duration = -1
						}
					}
					else_if = {
						limit = { has_province_modifier = depopulated_1 }
						add_province_modifier = {
							name = depopulated_2
							duration = -1
						}
					}
					else_if = {
						limit = { has_province_modifier = depopulated_2 }
						add_province_modifier = {
							name = depopulated_3
							duration = -1
						}
					}
				}
				else = {
					add_province_modifier = {
						name = moanders_road
						years = 1
					}
				}
			}
		}
	}
	
	after = {
		c_westgate = {
			holder_scope = {
				narrative_event = { id = tbminorstory.7 days = 5 }
			}
		}
		any_playable_ruler = {
			limit = {
				NOT = { has_landed_title = c_myth_drannor }
				ai = no
				OR = {
					region = cormanthor_region
					region = dalelands_region
					any_realm_province = {
						OR = {
							region = cormanthor_region
							region = dalelands_region
						}
					}
				}
			}
			narrative_event = { id = tbminorstory.10 }
		}
	}
}

narrative_event = {
	id = tbminorstory.7
	title = MOANDERSTORYT.1
	desc = MOANDERSTORYD.4
	picture = GFX_evt_abyss_1
	
	is_triggered_only = yes
	
	option = {
		name = MOANDERSTORYO.4
	}
	
	after = {
		any_playable_ruler = {
			limit = {
				NOT = { has_landed_title = c_westgate }
				ai = no
				OR = {
					region = dragon_coast_region
					any_realm_province = {
						region = dragon_coast_region
					}
				}
			}
			narrative_event = { id = tbminorstory.11 }
		}
	}
}

narrative_event = {
	id = tbminorstory.8
	title = MOANDERSTORYT.1
	desc = MOANDERSTORYD.5
	picture = GFX_evt_abyss_1
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = { trait = patron_moander }
		}
		name = MOANDERSTORYO.5a
	}
	
	option = {
		trigger = {
			trait = patron_moander
		}
		name = MOANDERSTORYO.5b
	}
}

narrative_event = {
	id = tbminorstory.9
	title = MOANDERSTORYT.1
	desc = MOANDERSTORYD.6
	picture = GFX_evt_abyss_1
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = { trait = patron_moander }
		}
		name = MOANDERSTORYO.6a
	}
	
	option = {
		trigger = {
			trait = patron_moander
		}
		name = MOANDERSTORYO.6b
	}
}

narrative_event = {
	id = tbminorstory.10
	title = MOANDERSTORYT.1
	desc = MOANDERSTORYD.7
	picture = GFX_evt_abyss_1
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = { trait = patron_moander }
		}
		name = MOANDERSTORYO.7a
	}
	
	option = {
		trigger = {
			trait = patron_moander
		}
		name = MOANDERSTORYO.7b
	}
}

narrative_event = {
	id = tbminorstory.11
	title = MOANDERSTORYT.1
	desc = MOANDERSTORYD.8
	picture = GFX_evt_abyss_1
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = { trait = patron_moander }
		}
		name = MOANDERSTORYO.8a
	}
	
	option = {
		trigger = {
			NOT = { trait = patron_moander }
		}
		name = MOANDERSTORYO.8b
	}
	
	option = {
		trigger = {
			trait = patron_moander
		}
		name = MOANDERSTORYO.8c
	}
}

#Malthiir's Coup in Hillsfar
character_event = {
	id = tbminorstory.12
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_character_flag = maalthir_coup }
		year = 1357
		month = 7
		c_hillsfar = {
			holder_scope = {
				NOT = {
					character = 56072
				}
				independent = yes
			}
		}
		56072 = {
			is_alive = yes
			is_landed = no
		}
	}
	
	immediate = {
		c_hillsfar = {
			holder_scope = {
				56072 = {
					create_title = {
						tier = DUKE # has to be
						landless = yes
						temporary = yes
						rebel = yes
						culture = tharian
						name = "Malthiir's Host"
						holder = THIS
						adventurer = yes
						short_name = yes
					}
					set_defacto_liege = THIS
					spawn_unit = {
						province = 267
						home = 267
						owner = THIS
						leader = THIS
						troops = {
							light_infantry = { 300 300 }
							heavy_infantry = { 50 50 }
							light_cavalry = { 50 50 }
							archers = { 150 150 }
						}
						match_character = PREV
						match_mult = 1.8
						disband_on_peace = yes
						cannot_inherit = yes
						maintenance_multiplier = 0
						reinforces = no
						can_toggle_looting = no
						merge = yes
					}
					spawn_unit = {
						province = 267
						home = 267
						owner = THIS
						leader = THIS
						troops = {
							light_infantry = { 300 300 }
							heavy_infantry = { 50 50 }
							light_cavalry = { 50 50 }
							archers = { 150 150 }
						}
						match_character = PREV
						match_mult = 0.3
						disband_on_peace = yes
						cannot_inherit = yes
						maintenance_multiplier = 0
						reinforces = no
						can_toggle_looting = no
						merge = yes
					}
					spawn_unit = {
						province = 267
						home = 267
						owner = THIS
						leader = THIS
						troops = {
							light_infantry = { 300 300 }
							heavy_infantry = { 50 50 }
							light_cavalry = { 50 50 }
							archers = { 150 150 }
						}
						match_character = PREV
						match_mult = 0.3
						disband_on_peace = yes
						cannot_inherit = yes
						maintenance_multiplier = 0
						reinforces = no
						can_toggle_looting = no
						merge = yes
					}
					war = {
						target = PREV
						casus_belli = claim
						thirdparty_title = PREVPREV
					}
				}
				character_event = { id = tbminorstory.13 }
			}
		}
	}
}

character_event = {
	id = tbminorstory.13
	desc = MALTHIIRD.1
	picture = GFX_evt_battle
	
	is_triggered_only = yes
	
	option = {
		name = MALTHIIRO.1
	}
}