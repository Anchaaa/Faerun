namespace = HRP

#################################DECISIONS######################################

# support people
	character_event = {
		id = HRP.100
		desc = EVTDESC_HRP_100
		picture = GFX_evt_noble_in_castle

		is_triggered_only = yes

		immediate = {
			random_demesne_province = {
				limit = {
					NOR = {
	          has_province_modifier = support_people_sneaky
	          has_province_modifier = support_people_direct
	          has_province_modifier = support_people_fundraising
				  }
					any_province_holding = {
						OR = {
							holding_type = city
							holding_type = temple
							holding_type = castle
							holding_type = tribal
						}
					}
	      }
	      save_event_target_as = tax_discount_target
			}
	  }
		# Tax discount on random demesne province
		option = {
			name = EVTOPTA_HRP_100

			ai_chance = {
				factor = 100
			}

			trigger = {
				event_target:tax_discount_target = { always = yes }
			}

			character_event = {	id = HRP.101 tooltip = EVTTOOLTIP_HRP_101 }
	  }
	}

	# Tax Discount on Demesne Province
	character_event = {
		id = HRP.101
		desc = EVTDESC_HRP_101
		picture = GFX_evt_noble_haughty_talking_to_peasants

		is_triggered_only = yes

		# first option High stewardship can trade vassal opinion for less sacrifice
		option = {
			name = EVTOPTA_HRP_101
			tooltip_info = stewardship

			trigger = {
				stewardship = 15
			}
			any_vassal = {
	      opinion = {
	        modifier = opinion_disappointed
	        who = FROM
	        years = 5
	      }
	    }

			event_target:tax_discount_target = {
				show_scope_change = no
				add_province_modifier = {
					modifier = support_people_sneaky
					duration = 1825
				}
			}
	    custom_tooltip = {
	      text = increase_prosperity_harper_tooltip
	      hidden_tooltip = {
	        event_target:tax_discount_target = {
	          change_variable = { which = prosperity_value value = 15 }
	        }
	      }
	    }
		}

		# second option straight up tax concession
		option = {
			name = EVTOPTB_HRP_101

			event_target:tax_discount_target = {
				show_scope_change = no
				add_province_modifier = {
					modifier = support_people_direct
					duration = 1825
				}
			}
	    custom_tooltip = {
	      text = increase_prosperity_harper_tooltip
	      hidden_tooltip = {
	        event_target:tax_discount_target = {
	          change_variable = { which = prosperity_value value = 15 }
	        }
	      }
	    }
		}

	  # third option High diplomacy fundraising
	  option = {
	    name = EVTOPTC_HRP_101
	    tooltip_info = diplomacy

	    trigger = {
	      diplomacy = 18
	    }

	    event_target:tax_discount_target = {
				show_scope_change = no
	      add_province_modifier = {
	        modifier = support_people_fundraising
	        duration = 1825
	      }
	    }
	    custom_tooltip = {
	      text = increase_prosperity_harper_tooltip
	      hidden_tooltip = {
	        event_target:tax_discount_target = {
	          change_variable = { which = prosperity_value value = 15 }
	        }
	      }
	    }
	  }
	}

# start sponsoring arts
	character_event = {
		id = HRP.200
		desc = EVTDESC_HRP_200
		picture = GFX_evt_market

		is_triggered_only = yes

		immediate  = {
			capital_scope = {
				add_province_modifier = {
					name = tribal_festival_modifier
					months = 5
				}
			}
		}

		# Circus
		option = {
			name = EVTOPTA_HRP_200

			add_character_modifier = {
				modifier = friendly_circuses
				duration = 1825
			}

			character_event = { id = HRP.201 days = 14 }
	  }
		# Artists
		option = {
			name = EVTOPTB_HRP_200

			add_character_modifier = {
				modifier = friendly_artists
				duration = 1825
			}

			character_event = { id = HRP.203 days = 14 }
	  }
		# Scholars
		option = {
			name = EVTOPTC_HRP_200

			add_character_modifier = {
				modifier = friendly_scholars
				duration = 1825
			}

			character_event = { id = HRP.205 days = 14 }
	  }
	}

	# circus 1
	character_event = {
		id = HRP.201
		desc = EVTDESC_HRP_201
		picture = GFX_evt_jugglers

		is_triggered_only = yes

		# make contacts
		option = {
			name = EVTOPTA_HRP_201

			add_character_modifier = {
				modifier = contacts_circuses
				duration = 1825
			}

			character_event = { id = HRP.202 days = 20 }
	  }
		# have fun
		option = {
			name = EVTOPTB_HRP_201

			add_character_modifier = {
				modifier = fun_circuses
				duration = 1825
			}

			character_event = { id = HRP.202 days = 20 }
	  }
	}

	# circus 2
	character_event = {
		id = HRP.202
		desc = EVTDESC_HRP_202
		picture = GFX_evt_jugglers

		is_triggered_only = yes

		# let them go
		option = {
			name = EVTOPTA_HRP_202

			add_character_modifier = {
				modifier = network_circuses
				duration = 1825
			}
			character_event = { id = HRP.207 days = 7 }
	  }
		# keep them around
		option = {
			name = EVTOPTB_HRP_202

			add_character_modifier = {
				modifier = homeland_circuses
				duration = 1825
			}
			character_event = { id = HRP.207 days = 7 }
	  }
	}

	# art 1
	character_event = {
		id = HRP.203
		desc = EVTDESC_HRP_203
		picture = GFX_evt_feast

		is_triggered_only = yes

		# beauty
		option = {
			name = EVTOPTA_HRP_203

			add_character_modifier = {
				modifier = beauty_artists
				duration = 1825
			}

			character_event = { id = HRP.204 days = 20 }
	  }
		# architecture
		option = {
			name = EVTOPTB_HRP_203

			add_character_modifier = {
				modifier = buildings_artists
				duration = 1825
			}

			character_event = { id = HRP.204 days = 20 }
	  }
	}

	# art 2
	character_event = {
		id = HRP.204
		desc = EVTDESC_HRP_204
		picture = GFX_evt_feast

		is_triggered_only = yes

		# share art
		option = {
			name = EVTOPTA_HRP_204

			add_character_modifier = {
				modifier = share_artists
				duration = 1825
			}
			character_event = { id = HRP.207 days = 7 }
	  }
		# keep art
		option = {
			name = EVTOPTB_HRP_204

			add_character_modifier = {
				modifier = keep_artists
				duration = 1825
			}
			character_event = { id = HRP.207 days = 7 }
	  }
	}

	# scholar 1
	character_event = {
		id = HRP.205
		desc = EVTDESC_HRP_205
		picture = GFX_evt_gathering_of_minds

		is_triggered_only = yes

		# research
		option = {
			name = EVTOPTA_HRP_205

			add_character_modifier = {
				modifier = researcher_scholars
				duration = 1825
			}

			character_event = { id = HRP.206 days = 20 }
	  }
		# literature
		option = {
			name = EVTOPTB_HRP_205

			add_character_modifier = {
				modifier = history_scholars
				duration = 1825
			}

			character_event = { id = HRP.206 days = 20 }
	  }
	}

	# scholar 2
	character_event = {
		id = HRP.206
		desc = EVTDESC_HRP_206
		picture = GFX_evt_gathering_of_minds

		is_triggered_only = yes

		# research
		option = {
			name = EVTOPTA_HRP_206

			add_character_modifier = {
				modifier = employ_scholars
				duration = 1825
			}
			character_event = { id = HRP.207 days = 7 }
	  }
		# literature
		option = {
			name = EVTOPTB_HRP_206

			add_character_modifier = {
				modifier = monetizing_scholars
				duration = 1825
			}
			character_event = { id = HRP.207 days = 7 }
	  }
	}

	# festival ends
	character_event = {
		id = HRP.207
		desc = EVTDESC_HRP_207
		picture = GFX_evt_market

		is_triggered_only = yes

		# end prosperity
		option = {
			name = EVTOPTA_HRP_207
			custom_tooltip = {
				text = capital_prospers_custom_tooltip
				hidden_tooltip = {
					capital_scope = {
						change_variable = { which = prosperity_value value = 10 }
					}
				}
			}
	  }
	}

# harper training
	character_event = {
		id = HRP.300
		desc = EVTDESC_HRP_300
		picture = GFX_evt_melee

		is_triggered_only = yes

		# twenty xp
		option = {
			name = EVTOPTA_HRP_300
			if = {
				limit = {
					z_barbarian = yes
					NOT = { trait = legendary_barbarian }
				}
				hidden_tooltip = {
					change_variable = { which = barbarian_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_bard = yes
					NOT = { trait = legendary_bard }
				}
				hidden_tooltip = {
					change_variable = { which = bard_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_cleric = yes
					NOT = { trait = legendary_cleric }
				}
				hidden_tooltip = {
					change_variable = { which = cleric_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_druid = yes
					NOT = { trait = legendary_druid }
				}
				hidden_tooltip = {
					change_variable = { which = druid_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_fighter = yes
					NOT = { trait = legendary_fighter }
				}
				hidden_tooltip = {
					change_variable = { which = fighter_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_monk = yes
					NOT = { trait = legendary_monk }
				}
				hidden_tooltip = {
					change_variable = { which = monk_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_paladin = yes
					NOT = { trait = legendary_paladin }
				}
				hidden_tooltip = {
					change_variable = { which = paladin_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_ranger = yes
					NOT = { trait = legendary_ranger }
				}
				hidden_tooltip = {
					change_variable = { which = ranger_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_rogue = yes
					NOT = { trait = legendary_rogue }
				}
				hidden_tooltip = {
					change_variable = { which = rogue_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_shadow = yes
					NOT = { trait = legendary_shadow }
				}
				hidden_tooltip = {
					change_variable = { which = shadow_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_sorcerer = yes
					NOT = { trait = legendary_sorcerer }
				}
				hidden_tooltip = {
					change_variable = { which = sorcerer_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_warlock = yes
					NOT = { trait = legendary_warlock }
				}
				hidden_tooltip = {
					change_variable = { which = warlock_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_wizard = yes
					NOT = { trait = legendary_wizard }
				}
				hidden_tooltip = {
					change_variable = { which = wizard_xp value = 20 }
				}
			}
	  }
	}

########################AI JOIN AND AI RANK UP###########################

character_event = { #force the AI to join a society
  id = HRP.110
  hide_window = yes
  is_triggered_only = yes

	immediate = {
		if = {
			limit = { #if he's already a member, will force a rank up 25% of the time
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				higher_tier_than = BARON
				society_member_of = harpers
				society_rank <= 3
				society_can_rank_up = yes
			}
			random_list = {
				75 = {}
				25 = {
					society_rank_up = 1
				}
			}
		}
		if = { #force the joining event on AI
			limit = {
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
        is_adult = yes
        is_in_society = no
        controls_religion = no
				block_general_event_trigger = no
			}
			character_event = { id = HRP.111 }
		}
	}
}

character_event = { #AI join event
	id = HRP.111
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		random_list = {
			60 = { # do nothing
			}
			40 = {
				trigger = {
					can_join_society = harpers
				}
				modifier = {
					factor = 2
					OR = {
						trait = scholar
						trait = socializer
						trait = schemer
					}
				}
				modifier = {
					factor = 2
					trait = just
				}
				modifier = {
					factor = 2
					trait = charitable
				}
				modifier = {
					factor = 2
					trait = patient
				}
				modifier = {
					factor = 2
					trait = diligent
				}
				modifier = {
					factor = 2
					trait = erudite
				}
				modifier = {
					factor = 2
					trait = kind
				}
				modifier = {
					factor = 2
					trait = brave
				}
				modifier = {
					factor = 0
					trait = cruel
				}
				modifier = {
					factor = 0
					is_evil_trigger = yes
				}
				modifier = {
					factor = 0.5
					trait = craven
				}
				modifier = {
					factor = 0.2
					trait = greedy
				}
				modifier = {
					factor = 0.1
					trait = lich
				}
				modifier = {
					factor = 0.1
					is_landed = no
				}
				join_society = harpers
				random_list = { # Artificially increase society influence for balance purposes, not really useful in my opinion.
					75 = {
						modifier = {
							factor = 0
							society_influence >= 30
						}
					}
					25 = {
					}
				}
				if = { # Make grandmaster is there is none
					limit = {
						NOT = {
							society = {
								any_society_member = {
									is_society_grandmaster = yes
								}
							}
						}
					}
					set_society_grandmaster = yes
				}
			}
		}
	}
}

###MISSIONS### (start on 1000)

#Mission tombola
character_event = {
	id = HRP.1000
	hide_window = yes

	is_triggered_only = yes
	is_in_society = yes
	only_capable = yes

	trigger = {
		society_member_of = harpers
		has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		NOT = { is_inaccessible_trigger = yes }
	}

	immediate = {
		random_society_member = {
			limit = {
				NOT = { character = ROOT }
				society_member_of = harpers
			}
			save_event_target_as = quest_giver
		}

		random_list = {
			15 = {
				character_event = { id = HRP.1001 } #Agent Elimination
			}
			20 = {
				modifier = {
					factor = 0
					ai = no
				}
				#Do nothing for AI
			}
		}
	}
}

#MISSION: #Agent Elimination
character_event = {
  id = HRP.1001
  hide_window = yes

  is_triggered_only = yes

  trigger = {
    any_realm_character = {
      NOT = {
        is_inaccessible_trigger = yes
        character = ROOT
      }
      prisoner = no
      OR = {
        society_member_of = arcane_brotherhood
        society_member_of = brotherhood_of_true_flame
        society_member_of = cult_of_the_dragon
        society_member_of = shadow_thieves
        society_member_of = night_masks
        society_member_of = shadow_telflamm
        society_member_of = twisted_rune
        society_member_of = eldreth_veluuthra
        society_member_of = the_satanists
        society_member_of = black_network
      }
    }
  }

	immediate = {
    random_realm_character = {
      limit = {
        NOT = { is_inaccessible_trigger = yes }
        NOT = { character = ROOT }
        prisoner = no
        OR = {
          society_member_of = arcane_brotherhood
          society_member_of = brotherhood_of_true_flame
          society_member_of = cult_of_the_dragon
          society_member_of = shadow_thieves
          society_member_of = night_masks
          society_member_of = shadow_telflamm
          society_member_of = twisted_rune
          society_member_of = eldreth_veluuthra
          society_member_of = the_satanists
          society_member_of = black_network
        }
      }
      save_event_target_as = elimination_target
    }

    if = {
			limit = {
				event_target:elimination_target = { always = yes }
				is_within_diplo_range = event_target:elimination_target
			}
			event_target:quest_giver = {
				character_event = { id = HRP.1002 }
			}
		}
	}
}

#Ping event for quest giver
character_event = {
	id = HRP.1002
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { event_target:elimination_target = { always = yes } }
			FROM = { society_quest_event = { id = HRP.1003 days = 7 random = 7 } }
		}
	}
}

#You get your target
society_quest_event = {
	id = HRP.1003
	title = quest_agent_elimination
	quest_target = event_target:elimination_target
  desc = EVTDESC_HRP_1003

	trigger = {
		is_in_society = yes
		event_target:elimination_target = {
			is_alive = yes
      prisoner = no
		}
	}

	is_triggered_only = yes

	option = {
		name = ACCEPT

		event_target:elimination_target = {
			set_quest_target = {
				id = quest_agent_elimination
				holder = ROOT
			}
		}

		hidden_effect = {
			if = { #Makes sure the AI actually does the mission
				limit = { ai = yes }
				random_list = {
					20 = {
						trigger = {
							attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 6 }
						}
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = HRP.1004 days = 150 random = 100 } #Triggers plot event
					}
					20 = {
						trigger = { attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 3 } }
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = HRP.1004 days = 300 random = 100 } #Triggers plot event
					}
					20 = {
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = HRP.1004 days = 500 random = 300 } #Triggers plot event
					}
					40 = {
						modifier = { event_target:elimination_target = { intrigue = 12 } factor = 1.2 }
						modifier = { event_target:elimination_target = { intrigue = 14 } factor = 1.2 }
						modifier = { event_target:elimination_target = { intrigue = 16 } factor = 1.2 }
						modifier = { event_target:elimination_target = { intrigue = 18 } factor = 1.2 }
						modifier = { event_target:elimination_target = { tier = COUNT } factor = 1.5 }
						modifier = { event_target:elimination_target = { tier = DUKE } factor = 2 }
						modifier = { event_target:elimination_target = { tier = KING } factor = 2.5 }
						modifier = { event_target:elimination_target = { tier = EMPEROR } factor = 5 }
						character_event = { id = HRP.1005 } #Clears quest
					}
				}
			}
		}
		event_target:elimination_target = {
			set_character_flag = appear_in_option
			clr_character_flag = appear_in_option
		}
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		hidden_effect = {
			add_character_modifier = {
				name = quest_cooldown_timer
				hidden = yes
				days = 1000
			}
		}

		ai_chance = { factor = 0 }
	}
}

#Helps AI do mission
character_event = {
  id = HRP.1004
  hide_window = yes
  is_triggered_only = yes
  trigger = {
  	NOT = { plot_target_char = { is_quest_target_of = ROOT } }
  	has_quest = quest_agent_elimination
  }
  immediate = {
  	character_event = { id = HRP.1008 }
  }
}

#AI clean-up
character_event = {
    id = HRP.1005
    hide_window = yes
    is_triggered_only = yes
    trigger = {
    	NOT = { plot_target_char = { is_quest_target_of = ROOT } }
    	has_quest = quest_agent_elimination
    }
    immediate = {
    	clr_quest = {
    		id = quest_agent_elimination
    		failure = yes
    	}
    }
}

#AI mission assassination attempt
character_event = {
	id = HRP.1008
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		FROM = { save_event_target_as = assassin }
    random_list = {
      60 = { #Kill
        random_list = {
          75 = {	#Not discovered
            modifier = {
              event_target:assassin = { intrigue = 12 }
              factor = 1.5
            }
            modifier = {
              event_target:assassin = { intrigue = 15 }
              factor = 1.5
            }
            event_target:elimination_target = { death = { death_reason = death_murder_unknown killer = event_target:assassin } }
          }
          25 = {	#Discovered
            modifier = {
              event_target:assassin = { NOT = { intrigue = 8 } }
              factor = 1.5
            }
            modifier = {
              event_target:assassin = { NOT = { intrigue = 5 } }
              factor = 1.5
            }
            event_target:elimination_target = { death = { death_reason = death_murder killer = event_target:assassin } }
            event_target:assassin = { character_event = { id = 10 } }
          }
        }
        modifier = {
          factor = 3
          event_target:elimination_target = { trait = incapable }
        }
        modifier = {
          factor = 2
          event_target:elimination_target = { prisoner = yes }
        }
        modifier = {
          factor = 1.3
          FROM = { attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 2 } }
        }
        modifier = {
          factor = 1.3
          FROM = { attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 4 } }
        }
        modifier = {
          factor = 1.3
          FROM = { attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 6 } }
        }
        modifier = {
          factor = 1.3
          FROM = { combat_rating_diff = { character = event_target:elimination_target value = 10 } }
        }
        modifier = {
          factor = 1.3
          FROM = { combat_rating_diff = { character = event_target:elimination_target value = 20 } }
        }
        modifier = {
          factor = 1.3
          FROM = { combat_rating_diff = { character = event_target:elimination_target value = 30 } }
        }
      }
      40 = { #No Kill
        random_list = {
          50 = {	#Not discovered
            modifier = {
              event_target:assassin = { intrigue = 12 }
              factor = 1.5
            }
            modifier = {
              event_target:assassin = { intrigue = 15 }
              factor = 1.5
            }
          }
          25 = {	#Discovered and wounded
            modifier = {
              event_target:assassin = { NOT = { intrigue = 8 } }
              factor = 1.5
            }
            modifier = {
              event_target:assassin = { NOT = { intrigue = 5 } }
              factor = 1.5
            }
            random_list = {
        			70 = {
        				event_target:assassin = {
        					tooltip = { add_trait = wounded }
        				}
        			}
        			30 = {
        				event_target:assassin = {
        					tooltip = { add_maimed_trait_effect = yes }
        				}
        			}
        		}
            event_target:assassin = { character_event = { id = 11 } }
          }
          25 = { #Assassin is Killed
            modifier = {
              factor = 1.3
              event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 10 } }
            }
            modifier = {
              factor = 1.3
              event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 20 } }
            }
            modifier = {
              factor = 1.3
              event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 30 } }
            }
            event_target:assassin = { death = { death_reason = death_battle killer = event_target:elimination_target } }
            event_target:assassin = { character_event = { id = 11 } }
          }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { attribute_diff = { character = event_target:assassin attribute = intrigue value = 2 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { attribute_diff = { character = event_target:assassin attribute = intrigue value = 4 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { attribute_diff = { character = event_target:assassin attribute = intrigue value = 6 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 10 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 20 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 30 } }
        }
      }
    }
	}
}
