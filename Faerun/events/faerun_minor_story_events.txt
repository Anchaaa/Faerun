namespace = minorstory

#Warlock Knights

#Spawns the voice of telos
character_event = {
	id = minorstory.51
	desc = WARLKNI.1
	picture = GFX_evt_died_battle
	border = GFX_event_normal_frame_war
	only_rulers = yes
	major = yes

	is_triggered_only = yes

	trigger = {
		date = 1430.2.1
		ROOT = { has_landed_title = c_darmshall }
		NOT = {
			has_global_flag = voice_of_telos_spawned
		}
		NOT = {
			has_game_rule = {
				name = minor_story_events
				value = off
			}
		}
	}

	major_trigger = {
		ai = no
		is_within_diplo_range = ROOT
	}

	immediate = {
		set_global_flag = voice_of_telos_spawned
		if = {
			limit = {
				c_52140 = {
					is_alive = yes
					is_adult = yes
					is_landed = no
					trait = legendary_warlock
					trait = ambitious
					religion = primordial
				}
			}
			c_52140 = {
				add_trait = proud
				add_trait = deceitful
				#add_trait = patron_telos
				#add_trait = chosen_telos
				add_trait = immortal # temporary
				immortal_age = 40
				give_nickname = nick_the_voice_of_telos
				join_society = warlock_knights
				set_society_grandmaster = yes
				wealth = 500
				set_character_flag = i_am_voice_of_telos
				character_event = { id = minorstory.52 days = 1 }
			}
		}
		else_if = {
			create_character = {
				random_traits = no
				name = "Karrod"
				dynasty = 1423 # Eltharn
				culture = vaasan
				religion = primordial
				attributes = {
					martial = 8
					intrigue = 9
					learning = 10
				}
				trait = creature_human
				trait = elusive_shadow
				trait = legendary_warlock
				trait = ambitious
				trait = proud
				trait = deceitful
				#trait = patron_telos
				#trait = chosen_telos
				trait = immortal # temporary
				age = 40
				immortal_age = 40
				give_nickname = nick_the_voice_of_telos
				join_society = warlock_knights
				set_society_grandmaster = yes
			}
			new_character = {
				wealth = 500
				set_character_flag = i_am_voice_of_telos
				character_event = { id = minorstory.52 days = 1 }
			}
		}
	}

	option = {
		name = EVTOPTA_WARLKNI_1
	}
}

#Creates Duchy
character_event = {
	id = minorstory.52
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		create_title = {
			tier = DUKE
			landless = yes
			temporary = yes
			culture = vaasan
			name = "CLAIMANT_ADVENTURE"
			holder = ROOT
			adventurer = yes
		}
		set_character_flag = duchy_adventurer
			c_darmshall = {
			add_claim = ROOT
		}
		c_haatar_baen = {
			add_claim = ROOT
		}
		d_sunderland = {
			add_claim = ROOT
		}
		character_event = { id = minorstory.53 }
	}
}

#War and troops
character_event = {
	id = minorstory.53
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		c_darmshall = {
			holder_scope = {
				reverse_unsafe_war = {
					target = ROOT
					casus_belli = invasion
					thirdparty = ROOT
					thirdparty_title = PREV
				}
			}
		}

		if = {
			limit = {
				has_game_rule = {
					name = minor_story_events
					value = on
				}
			}
			spawn_unit = {
				owner = ROOT
				province = 357 # Darmshall
				home = 357 # Darmshall
				troops = {
					archers = { 500 500 }
					light_infantry = { 500 500 }
					light_cavalry = { 700 700 }
					heavy_infantry = { 1000 1000 }
					pikemen = { 400 400 }
					knights = { 400 400 }
				}
				attrition = 0.5
				disband_on_peace = no
				maintenance_multiplier = 0.3
				cannot_inherit = yes
				merge = yes
			}
			spawn_unit = {
				owner = ROOT
				province = 357 # Darmshall
				home = 357 # Darmshall
				troops = {
					archers = { 500 500 }
					light_infantry = { 500 500 }
					light_cavalry = { 700 700 }
					heavy_infantry = { 1000 1000 }
					pikemen = { 400 400 }
					knights = { 400 400 }
				}
				attrition = 0.5
				disband_on_peace = no
				maintenance_multiplier = 0.3
				cannot_inherit = yes
				merge = yes
			}
			spawn_unit = {
				owner = ROOT
				province = 357 # Darmshall
				home = 357 # Darmshall
				troops = {
					archers = { 500 500 }
					light_infantry = { 500 500 }
					light_cavalry = { 700 700 }
					heavy_infantry = { 1000 1000 }
					pikemen = { 400 400 }
					knights = { 400 400 }
				}
				attrition = 0.5
				disband_on_peace = no
				maintenance_multiplier = 0.3
				cannot_inherit = yes
				merge = yes
			}
		}
		else_if = {
			limit = {
				has_game_rule = {
					name = minor_story_events
					value = dangerous
				}
			}
			spawn_unit = {
				owner = ROOT
				province = 357 # Darmshall
				home = 357 # Darmshall
				troops = {
					light_cavalry = { 2200 2200 }
					knights = { 550 550 }
				}
				attrition = 0.5
				disband_on_peace = no
				maintenance_multiplier = 0.2
				cannot_inherit = yes
				merge = yes
			}
			spawn_unit = {
				owner = ROOT
				province = 357 # Darmshall
				home = 357 # Darmshall
				troops = {
					light_cavalry = { 2200 2200 }
					knights = { 550 550 }
				}
				attrition = 0.5
				disband_on_peace = no
				maintenance_multiplier = 0.2
				cannot_inherit = yes
				merge = yes
			}
			spawn_unit = {
				owner = ROOT
				province = 357 # Darmshall
				home = 357 # Darmshall
				troops = {
					light_cavalry = { 2200 2200 }
					knights = { 550 550 }
				}
				attrition = 0.5
				disband_on_peace = no
				maintenance_multiplier = 0.2
				cannot_inherit = yes
				merge = yes
			}
		}
		else_if = {
			limit = {
				has_game_rule = {
					name = minor_story_events
					value = lethal
				}
			}
			spawn_unit = {
				owner = ROOT
				province = 357 # Darmshall
				home = 357 # Darmshall
				troops = {
					light_cavalry = { 4400 2200 }
					knights = { 1100 1100 }
				}
				attrition = 0.5
				disband_on_peace = no
				reinforces = yes
				reinforce_rate_multiplier = 0.1
				maintenance_multiplier = 0
				cannot_inherit = yes
				merge = yes
			}
			spawn_unit = {
				owner = ROOT
				province = 357 # Darmshall
				home = 357 # Darmshall
				troops = {
					light_cavalry = { 4400 2200 }
					knights = { 1100 1100 }
				}
				attrition = 0.5
				disband_on_peace = no
				reinforces = yes
				reinforce_rate_multiplier = 0.1
				maintenance_multiplier = 0
				cannot_inherit = yes
				merge = yes
			}
			spawn_unit = {
				owner = ROOT
				province = 357 # Darmshall
				home = 357 # Darmshall
				troops = {
					light_cavalry = { 4400 2200 }
					knights = { 1100 1100 }
				}
				attrition = 0.5
				disband_on_peace = no
				reinforces = yes
				reinforce_rate_multiplier = 0.1
				maintenance_multiplier = 0
				cannot_inherit = yes
				merge = yes
			}
		}

		create_random_soldier = {
			random_traits = yes
			dynasty = none
			religion = ROOT
			culture = ROOT
			age = 30
		}
		create_random_soldier = {
			random_traits = yes
			dynasty = none
			religion = ROOT
			culture = ROOT
			age = 30
		}
		create_random_soldier = {
			random_traits = yes
			dynasty = none
			religion = ROOT
			culture = ROOT
			age = 30
		}
	}
}

#Sets up the global flag if starting game date is after the Warlock Knights' canon appearance
character_event = {
	id = minorstory.54
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		date = 1430.1.1
		NOT = { has_global_flag = voice_of_telos_spawned }
	}

	immediate = {
		set_global_flag = voice_of_telos_spawned
	}
}

#Gives a successful voice of telos k_warlock_knights
character_event = {
	id = minorstory.55
	hide_window = yes
	only_rulers = yes

	is_triggered_only = yes

	trigger = {
		has_character_flag = i_am_voice_of_telos
		FROM = {
			title = c_darmshall
		}
	}

	immediate = {
		357 = {
			culture = vaasan
			religion = primordial
			set_name = "Telos"
		}
		ROOT = {
			set_government_type = feudal_government
			grant_title = k_warlock_knights
			any_demesne_title = {
				add_law = succ_magic_warlock
			}
		}
	}
	after = {
		clr_character_flag = i_am_voice_of_telos
	}
}