namespace = olstory

#Bane Returns
narrative_event = {
	id = olstory.1
	title = BANERETURNTITLE.1
	desc = BaneReturn.1
	major = yes

	is_triggered_only = no

	picture = GFX_evt_bane_1

	trigger = {
		date = 1372.2.1
		NOT = { date = 1373.2.1 }
		NOT = { has_global_flag = bane_returned }
	}

	immediate = {
		any_character = {
			if = {
				limit = {
					trait = patron_iyachtu_xvim
				}
				remove_trait = patron_iyachtu_xvim
				add_trait = patron_bane
			}
		}
		c_56006 = {
			if = {
				limit = {
					religion = dead_three
				}
				remove_trait = possessed
				add_trait = chosen_bane
				add_trait = patron_bane
			}
		}
	}

	option = {
		name = {
			text = EVTOPTA_BANERETURN1
			trigger = {
				NOR = {
					trait = patron_bane
					trait = chosen_bane
					trait = patron_iyachtu_xvim
					religion = dead_three
					religion = loviatar
				}
			}
		}
		name = {
			text = EVTOPTB_BANERETURN1
			trigger = {
				OR = {
					trait = patron_bane
					trait = chosen_bane
					trait = patron_iyachtu_xvim
				}
			}
		}
		name = {
			text = EVTOPTC_BANERETURN1
			trigger = {
				NOR = {
					trait = patron_bane
					trait = chosen_bane
					trait = patron_iyachtu_xvim
				}
				OR = {
					religion = dead_three
					religion = loviatar
				}
			}
		}
	}
	after = {
		set_global_flag = bane_returned
	}
}

character_event = { #Sets up Bane's return if starting a game after the canon date of his return
	id = olstory.2
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		date = 1372.4.1
		NOT = { has_global_flag = bane_returned }
	}

	immediate = {
		any_character = {
			if = {
				limit = {
					trait = patron_iyachtu_xvim
				}
				remove_trait = patron_iyachtu_xvim
				add_trait = patron_bane
			}
		}
	}

	after = {
		set_global_flag = bane_returned
	}
}

#The King of Shadows

character_event = {
	id = olstory.11
	desc = KINGOFSHADOWS.1
	picture = GFX_evt_plane_shadowfell_1
	border = GFX_event_normal_frame_war
	only_rulers = yes

	is_triggered_only = yes

	trigger = {
		date = 1374.2.1
		ROOT = { has_landed_title = d_neverwinter }
		NOT = {
			has_global_flag = king_of_shadows_spawned
		}
		has_game_rule = {
			name = minor_story_events
			value = on
		}
	}

	immediate = {
		set_global_flag = king_of_shadows_spawned

		create_character = {
				random_traits = no
				name = "King of Shadows"
				dynasty = 2512 # of Illefarn
				culture = highcoaster
				religion = shadow_gods
				attributes = {
					learning = 10
					intrigue = 6
					martial = 10
				}
				trait = creature_human
				trait = lich
				trait = strong
				trait = quick
				trait = lunatic
				trait = diligent
				trait = stubborn
				trait = legendary_wizard
				trait = immortal
				trait = mastermind_theologian
				trait = patron_shar
				age = 1374
				immortal_age = 30
				flag = ai_flag_refuse_conversion
		}
		new_character = {
			set_graphical_culture = wraith
			set_character_flag = undead_court
			add_character_modifier = {
				name = wiz_necromancy
				duration = -1
			}
			wealth = 500
			character_event = { id = olstory.12 days = 1 }
			character_event = { id = wizinit.1 days = 1 }
		}
	}

	option = {
		name = "EVTOPTA_KINGOFSHADOWS_1"
	}

}

character_event = {
	id = olstory.12
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		grant_title = k_army_of_shadows
		set_character_flag = raiding_adventurer

		d_neverwinter = {
			add_claim = ROOT
		}
		c_neverwinter = {
			add_claim = ROOT
		}
		c_mere_of_dead_men = {
			add_claim = ROOT
		}
		k_illefarn = {
			add_claim = ROOT
		}
		character_event = { id = olstory.13 days = 1 }
	}
}


character_event = {
	id = olstory.13
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		d_neverwinter = {
			holder_scope = {
				reverse_unsafe_war = {
					target = ROOT
					casus_belli = invasion
					thirdparty = ROOT
					thirdparty_title = PREV
				}
			}
		}
		spawn_unit = {
			owner = ROOT
			province = 12
			home = 9
			troops = {
				archers = { 100 100 }
				light_cavalry = { 200 200 }
				undead_troops = { 1700 1700 }
			}
			attrition = 0
			disband_on_peace = no
			maintenance_multiplier = 0
			cannot_inherit = yes
		}
		spawn_unit = {
			owner = ROOT
			province = 12
			home = 9
			troops = {
				archers = { 100 100 }
				light_cavalry = { 200 200 }
				undead_troops = { 1700 1700 }
			}
			attrition = 0
			disband_on_peace = no
			maintenance_multiplier = 0
			cannot_inherit = yes
		}
		spawn_unit = {
			owner = ROOT
			province = 12
			home = 9
			troops = {
				archers = { 100 100 }
				light_cavalry = { 200 200 }
				undead_troops = { 1700 1700 }
			}
			attrition = 0
			disband_on_peace = no
			maintenance_multiplier = 0
			cannot_inherit = yes
		}
	}
}

character_event = { #Sets up the global flag if starting game date is after the king of shadows' canon return
	id = olstory.14
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		date = 1374.4.1
		NOT = { has_global_flag = king_of_shadows_spawned }
	}

	immediate = {
		set_global_flag = king_of_shadows_spawned
	}
}
